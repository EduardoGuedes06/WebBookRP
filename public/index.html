<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ronaldo Pereira - Plataforma do Autor</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,700;0,800;1,600&family=Caveat:wght@600&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#0f172a', secondary: '#334155', accent: '#d97706',
                        'accent-hover': '#b45309', 'bg-body': '#f8fafc', 'text-main': '#1e293b',
                        'amazon': '#FF9900', 'shopee': '#EE4D2D', 'ml': '#FFE600'
                    },
                    fontFamily: {
                        sans: ['Montserrat', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                        hand: ['Caveat', 'cursive'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'float': 'float 6s ease-in-out infinite',
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0', transform: 'translateY(10px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } },
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } }
                    }
                }
            }
        }
    </script>

    <style>
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
        body { -webkit-font-smoothing: antialiased; }
        .glass-header { background-color: rgba(255, 255, 255, 0.95); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(0,0,0,0.05); box-shadow: 0 4px 20px rgba(0,0,0,0.03); }
        .card-interaction:hover { transform: translateY(-5px); box-shadow: 0 20px 40px -10px rgba(0,0,0,0.15); }
        .polaroid { background: white; padding: 1rem; padding-bottom: 3rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transform: rotate(-3deg); transition: transform 0.3s; }
        .polaroid:hover { transform: rotate(0deg) scale(1.02); z-index: 10; }
        .tape { background-color: rgba(255, 255, 255, 0.4); box-shadow: 0 1px 3px rgba(0,0,0,0.1); position: absolute; height: 30px; width: 100px; transform: rotate(-45deg); opacity: 0.7; }
        .form-input:focus { outline: none; border-color: #d97706; box-shadow: 0 0 0 4px rgba(217, 119, 6, 0.1); }
        /* Admin Dashboard */
        .dashboard-card { background: white; border-radius: 1rem; padding: 1.5rem; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        /* Pagination */
        .pagination-btn { width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; border-radius: 12px; font-weight: 600; color: #64748b; background: white; border: 1px solid #e2e8f0; transition: all 0.3s; cursor: pointer; }
        .pagination-btn.active { background-color: #0f172a; color: white; border-color: #0f172a; box-shadow: 0 4px 12px rgba(15, 23, 42, 0.2); }
        .pagination-btn:hover:not(.active) { background-color: #f8fafc; border-color: #cbd5e1; color: #0f172a; }
        .pagination-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    </style>
</head>
<body class="bg-bg-body text-text-main font-sans antialiased overflow-x-hidden selection:bg-accent selection:text-white">

    <div id="cropper-modal" class="hidden fixed inset-0 bg-black/90 z-[80] flex flex-col items-center justify-center p-4">
        <div class="w-full max-w-4xl h-[70vh] bg-black rounded-lg overflow-hidden relative">
            <img id="cropper-image" src="" class="max-w-full block">
        </div>
        <div class="flex gap-4 mt-6">
            <button onclick="window.app.cancelCrop()" class="bg-white text-gray-800 px-6 py-3 rounded-full font-bold shadow-lg hover:bg-gray-100 transition">
                Cancelar
            </button>
            <button onclick="window.app.confirmCrop()" class="bg-accent text-white px-8 py-3 rounded-full font-bold shadow-lg hover:bg-accent-hover transition flex items-center gap-2">
                <i class="ph-bold ph-crop"></i> Recortar & Confirmar
            </button>
        </div>
    </div>

    <div id="toast-container" class="fixed top-24 right-5 z-[100] flex flex-col gap-3 pointer-events-none"></div>

    <div id="header-container" class="fixed top-0 w-full z-50 transition-all duration-300"></div>

    <main id="app" class="min-h-screen pt-28 pb-16 px-4 md:px-8 max-w-7xl mx-auto">
    </main>

    <div id="footer-container"></div>

    <div id="modal-overlay" class="hidden fixed inset-0 bg-primary/80 backdrop-blur-sm z-[60] flex items-center justify-center p-4 transition-opacity duration-300 opacity-0">
        <div id="modal-content" class="bg-white w-full max-w-2xl rounded-2xl shadow-2xl overflow-hidden transform transition-all scale-95 opacity-0 relative flex flex-col max-h-[90vh]">
            <div class="bg-white p-6 flex justify-between items-center border-b border-gray-100 z-10 shrink-0">
                <h3 id="modal-title" class="text-2xl font-serif font-bold text-primary">Título</h3>
                <button onclick="window.app.closeModal()" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition"><i class="ph ph-x text-xl"></i></button>
            </div>
            <div id="modal-body" class="p-8 overflow-y-auto flex-grow bg-gray-50/50"></div>
            <div id="modal-footer" class="p-6 border-t border-gray-100 bg-white flex justify-end gap-3 z-10 shrink-0"></div>
        </div>
    </div>

    <script>
        // ==========================================
        // 1. TEMPLATES HTML
        // ==========================================
const TEMPLATES = {
            header: `
                <header class="w-full py-4 transition-all duration-300">
                    <div class="container mx-auto px-4 flex justify-between items-center">
                        <a href="#/" class="text-2xl font-bold text-primary tracking-tighter font-serif group flex items-center gap-2">
                            <span class="w-8 h-8 bg-primary text-white flex items-center justify-center rounded-lg font-serif italic text-xl group-hover:bg-accent transition shadow-lg">R</span>
                            <span>RONALDO <span class="text-accent">PEREIRA</span>.</span>
                        </a>

                        <nav class="hidden md:flex gap-6 items-center font-medium text-sm tracking-wide text-gray-600">
                            <a href="#/" class="hover:text-accent transition py-2 font-bold uppercase text-xs">Início</a>
                            <a href="#/livros" class="hover:text-accent transition py-2 font-bold uppercase text-xs">Livros</a>
                            <a href="#/servicos" class="hover:text-accent transition py-2 font-bold uppercase text-xs">Serviços</a>
                            <a href="#/comunidade" class="hover:text-accent transition py-2 font-bold uppercase text-xs text-accent">Comunidade</a>
                            <a href="#/autor" class="hover:text-accent transition py-2 font-bold uppercase text-xs">Sobre</a>
                            
                            <div class="h-6 w-px bg-gray-300 mx-2"></div>

                            <a href="#/painel" class="hover:text-primary transition py-2 font-bold uppercase text-xs flex items-center gap-1 text-gray-400 hover:text-gray-900" title="Acesso Restrito">
                                <i class="ph-fill ph-lock-key text-lg"></i> Painel
                            </a>
                        </nav>

                        <button id="menu-button" class="md:hidden text-2xl text-primary p-2">
                            <i class="ph ph-list"></i>
                        </button>
                    </div>

                    <div id="mobile-menu" class="hidden md:hidden absolute top-full left-0 w-full bg-white shadow-xl border-t border-gray-100 flex flex-col p-4 z-50 animate-fade-in">
                        <a href="#/" class="py-3 px-4 hover:bg-gray-50 rounded font-medium">Início</a>
                        <a href="#/livros" class="py-3 px-4 hover:bg-gray-50 rounded font-medium">Livros</a>
                        <a href="#/comunidade" class="py-3 px-4 hover:bg-gray-50 rounded font-medium text-accent">Comunidade</a>
                        <a href="#/autor" class="py-3 px-4 hover:bg-gray-50 rounded font-medium">Sobre</a>
                        <a href="#/painel" class="py-3 px-4 hover:bg-gray-50 rounded font-medium">Painel Admin</a>
                    </div>
                </header>
            `,
            home: `
                <section class="flex flex-col-reverse md:flex-row items-center gap-16 py-12 md:py-24 mb-20 animate-fade-in">
                    <div class="flex-1 space-y-8 text-center md:text-left z-10">
                        <div class="inline-flex items-center gap-2 bg-white border border-gray-200 px-4 py-1.5 rounded-full shadow-sm mb-2">
                            <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                            <span class="text-xs font-bold uppercase tracking-widest text-gray-600">Último Lançamento</span>
                        </div>
                        <h1 class="text-5xl md:text-7xl font-black text-primary leading-[1] tracking-tight">
                            Mundos que <br><span class="text-transparent bg-clip-text bg-gradient-to-r from-accent to-orange-400 font-serif italic pr-2">colidem.</span>
                        </h1>
                        <p class="text-lg md:text-xl text-gray-600 max-w-lg mx-auto md:mx-0 leading-relaxed font-medium">
                            Ficção especulativa de alto nível. Junte-se a milhares de leitores e explore o impossível.
                        </p>
                        <div class="flex flex-col sm:flex-row gap-4 justify-center md:justify-start pt-6">
                            <a href="#/livros" class="bg-primary text-white px-10 py-4 rounded-full font-bold shadow-xl hover:bg-slate-800 hover:shadow-2xl hover:scale-105 transition transform text-sm uppercase tracking-wide">
                                Ler Agora
                            </a>
                        </div>
                    </div>
                    
                    <div class="flex-1 flex justify-center relative w-full">
                        <div class="absolute inset-0 bg-gradient-to-tr from-accent/20 to-transparent blur-[100px] rounded-full"></div>
                        <img src="https://placehold.co/400x550/1e293b/FFF?text=Capa+Nova" class="rounded shadow-2xl rotate-3 hover:rotate-0 transition duration-700 w-full max-w-sm border-8 border-white relative z-10 animate-float" alt="Autor">
                    </div>
                </section>

                <section class="py-20">
                    <div class="flex items-end justify-between mb-12">
                        <div>
                             <h2 class="text-4xl font-bold text-primary font-serif mb-2">Em Destaque</h2>
                             <p class="text-gray-500">O que os leitores estão devorando agora.</p>
                        </div>
                        <a href="#/livros" class="text-sm font-bold text-accent hover:underline uppercase tracking-widest mb-2">Ver Catálogo -></a>
                    </div>
                    
                    <div id="home-highlights" class="grid grid-cols-1 md:grid-cols-2 gap-8"></div>
                </section>

                <section class="my-20 bg-primary rounded-[3rem] p-12 md:p-24 text-center relative overflow-hidden text-white shadow-2xl">
                    <div class="absolute top-0 left-0 w-full h-full opacity-10 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')]"></div>
                    <div class="relative z-10 max-w-4xl mx-auto">
                        <i class="ph-fill ph-quotes text-6xl text-accent mb-6 opacity-50 block mx-auto"></i>
                        <h3 class="text-3xl md:text-5xl font-serif font-bold leading-tight mb-8">"Escrever é a única forma que encontrei de viver mil vidas em uma só. E convido você a viver elas comigo."</h3>
                        <p class="text-slate-400 font-medium tracking-widest uppercase text-sm">— Ronaldo Pereira</p>
                    </div>
                </section>
            `,

            book_details: `
                <div class="animate-fade-in pt-10">
                    <button onclick="history.back()" class="flex items-center gap-2 text-gray-500 hover:text-primary font-bold mb-8 transition">
                        <i class="ph-bold ph-arrow-left"></i> Voltar para Catálogo
                    </button>
                    
                    <div class="bg-white rounded-[2rem] shadow-2xl border border-gray-100 overflow-hidden">
                        <div class="grid grid-cols-1 md:grid-cols-12 gap-0">
                            
                            <div class="md:col-span-5 bg-gray-100 p-10 flex items-center justify-center relative overflow-hidden">
                                <div class="absolute inset-0 bg-primary/5 opacity-50"></div>
                                <div class="absolute top-0 left-0 w-full h-full bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
                                <img id="detail-img" src="" class="rounded-lg shadow-2xl w-3/4 max-w-sm rotate-1 relative z-10 hover:rotate-0 transition duration-500">
                                
                                <div class="absolute top-5 right-5 bg-red-600 text-white text-xs font-bold px-3 py-1 rounded-full shadow-lg transform rotate-3 animate-pulse">
                                    OFERTA ESPECIAL
                                </div>
                            </div>
                            
                            <div class="md:col-span-7 p-10 md:p-14 flex flex-col justify-center">
                                <span id="detail-genre" class="text-accent font-bold tracking-widest text-xs uppercase mb-3 block"></span>
                                <h1 id="detail-title" class="text-4xl md:text-5xl font-black text-primary mb-6 font-serif leading-tight"></h1>
                                
                                <div class="flex items-center gap-6 mb-8 text-sm text-gray-500">
                                    <span class="flex items-center gap-1"><i class="ph-fill ph-star text-yellow-400 text-lg"></i> 4.9 (120 reviews)</span>
                                    <span class="w-px h-4 bg-gray-300"></span>
                                    <span>320 Páginas</span>
                                </div>

                                <p class="text-gray-600 text-lg leading-relaxed mb-8 font-light">
                                    Uma narrativa envolvente que desafia a percepção da realidade. Prepare-se para não conseguir largar.
                                </p>

                                <div class="flex items-end gap-6 mb-6">
                                    <div class="text-4xl font-black text-primary" id="detail-price"></div>
                                    <p class="text-sm text-gray-400 pb-2 decoration-slice line-through decoration-red-500 decoration-2">De R$ 59,90</p>
                                    <span class="bg-green-100 text-green-800 text-xs font-bold px-2 py-1 rounded mb-2">30% OFF</span>
                                </div>

                                <div class="bg-gradient-to-r from-orange-100 to-amber-50 border-l-4 border-accent p-4 mb-8 rounded-r-lg shadow-sm">
                                    <div class="flex items-start gap-3">
                                        <i class="ph-fill ph-tag text-accent text-2xl mt-1"></i>
                                        <div>
                                            <h4 class="font-bold text-gray-800">Promoção de Lançamento!</h4>
                                            <p class="text-sm text-gray-600">Compre agora e ganhe um marcador exclusivo.</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="flex flex-col gap-3 max-w-md">
                                    <a id="link-amazon" href="#" target="_blank" class="flex items-center justify-between px-6 py-4 bg-gray-900 text-white rounded-xl hover:bg-slate-800 transition shadow-lg group">
                                        <div class="flex items-center gap-3">
                                            <i class="ph-bold ph-amazon-logo text-2xl text-[#FF9900]"></i>
                                            <span class="font-bold">Comprar na Amazon</span>
                                        </div>
                                        <i class="ph-bold ph-arrow-right group-hover:translate-x-1 transition"></i>
                                    </a>

                                    <a id="link-ml" href="#" target="_blank" class="flex items-center justify-between px-6 py-4 bg-[#FFE600] text-blue-900 rounded-xl hover:bg-yellow-400 transition shadow-md group border border-yellow-400">
                                        <div class="flex items-center gap-3">
                                            <i class="ph-bold ph-shopping-bag-open text-2xl"></i>
                                            <span class="font-bold">Mercado Livre</span>
                                        </div>
                                        <i class="ph-bold ph-arrow-right group-hover:translate-x-1 transition"></i>
                                    </a>

                                    <a id="link-shopee" href="#" target="_blank" class="flex items-center justify-between px-6 py-4 bg-[#EE4D2D] text-white rounded-xl hover:bg-orange-600 transition shadow-md group">
                                        <div class="flex items-center gap-3">
                                            <i class="ph-bold ph-shopping-bag text-2xl"></i>
                                            <span class="font-bold">Shopee</span>
                                        </div>
                                        <i class="ph-bold ph-arrow-right group-hover:translate-x-1 transition"></i>
                                    </a>
                                </div>

                                <div class="mt-6 flex items-center gap-2">
                                     <button id="detail-fav-btn" class="flex items-center gap-2 text-gray-500 hover:text-red-500 transition font-bold text-sm px-4 py-2 rounded-lg hover:bg-red-50">
                                        <i id="detail-fav-icon" class="ph-fill ph-heart text-xl text-gray-300"></i> Adicionar aos Favoritos
                                     </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-16 grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="col-span-2">
                        <h3 class="text-2xl font-bold text-primary mb-6 font-serif">Sinopse Completa</h3>
                        <div class="prose text-gray-600 leading-loose">
                            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
                            <p class="mt-4">Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-2xl font-bold text-primary mb-6 font-serif">Outros Leitores</h3>
                        <div class="space-y-4">
                            <div class="bg-white p-4 rounded-xl border border-gray-100 shadow-sm">
                                <div class="flex text-yellow-400 text-xs mb-2"><i class="ph-fill ph-star"></i><i class="ph-fill ph-star"></i><i class="ph-fill ph-star"></i><i class="ph-fill ph-star"></i><i class="ph-fill ph-star"></i></div>
                                <p class="text-sm text-gray-600 italic">"Simplesmente fantástico. O final me pegou de surpresa!"</p>
                                <p class="text-xs font-bold text-gray-400 mt-2">- @leitora_voraz</p>
                            </div>
                            <div class="bg-white p-4 rounded-xl border border-gray-100 shadow-sm">
                                <div class="flex text-yellow-400 text-xs mb-2"><i class="ph-fill ph-star"></i><i class="ph-fill ph-star"></i><i class="ph-fill ph-star"></i><i class="ph-fill ph-star"></i><i class="ph-fill ph-star"></i></div>
                                <p class="text-sm text-gray-600 italic">"A construção de mundo é impecável."</p>
                                <p class="text-xs font-bold text-gray-400 mt-2">- Marcos D.</p>
                            </div>
                        </div>
                    </div>
                </div>
            `,

            livros: `
                <div class="animate-fade-in pt-10 pb-20">
                    <div class="text-center mb-16">
                        <span class="text-accent font-bold tracking-[0.2em] text-xs uppercase mb-3 block">Biblioteca Oficial</span>
                        <h2 class="text-4xl md:text-5xl font-black text-primary mb-6 font-serif">Obras Publicadas</h2>
                        <p class="text-gray-500 max-w-2xl mx-auto text-lg">Coleção exclusiva. Escolha sua próxima aventura.</p>
                    </div>

                    <div class="max-w-6xl mx-auto">
                        <div id="books-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-10"></div>
                        <div id="pagination-controls" class="flex justify-center items-center gap-3 mt-16 pt-8 border-t border-gray-100"></div>
                    </div>
                </div>
            `,
            servicos: `
                <div class="text-center mb-16 animate-fade-in pt-10">
                    <h2 class="text-5xl font-black text-primary mb-6 font-serif">Mentoria & Serviços</h2>
                    <p class="text-gray-500 text-lg max-w-2xl mx-auto">
                        Do rascunho ao best-seller. Vamos trabalhar juntos na sua história.
                    </p>
                </div>
                <div id="services-grid" class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-7xl mx-auto"></div>
            `,
            community: `
                <div class="animate-fade-in">
                    <div class="bg-primary rounded-[2rem] p-10 md:p-20 text-center text-white mb-16 relative overflow-hidden">
                        <div class="absolute inset-0 opacity-20 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"></div>
                        <div class="relative z-10">
                            <span class="bg-white/10 text-white px-4 py-1 rounded-full text-xs font-bold uppercase tracking-widest mb-4 inline-block backdrop-blur-md">O Blog do Autor</span>
                            <h2 class="text-4xl md:text-6xl font-serif font-bold mb-6">Bastidores & Café</h2>
                            <p class="text-slate-300 max-w-2xl mx-auto text-lg leading-relaxed">
                                Atualizações sobre novos lançamentos, dicas de escrita e discussões abertas com os leitores.
                            </p>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">
                        <div class="lg:col-span-2">
                            <div class="bg-white border border-gray-200 rounded-2xl p-8 shadow-lg mb-10">
                                <h3 class="text-2xl font-bold text-primary font-serif mb-2"><i class="ph-fill ph-fire text-accent"></i> Discussão da Semana</h3>
                                <p class="text-gray-600 mb-6">Teorias sobre o final de "O Código da Eternidade": O que realmente aconteceu no portal?</p>
                                <div id="comments-section" class="space-y-6 mb-8 max-h-[400px] overflow-y-auto pr-2"></div>
                                <div id="comment-input-area" class="border-t border-gray-100 pt-6"></div>
                            </div>
                            <h4 class="font-bold text-gray-400 uppercase text-xs tracking-widest mb-6">Artigos Recentes</h4>
                            <div id="blog-feed" class="space-y-8"></div>
                        </div>
                        <div class="space-y-8">
                            <div class="bg-white border border-gray-100 p-6 rounded-2xl shadow-sm">
                                <h4 class="font-bold text-primary mb-6 flex items-center gap-2"><i class="ph-fill ph-chat-circle-text text-accent"></i> Últimos Comentários</h4>
                                <div class="space-y-6">
                                    <div class="flex gap-3"><img src="https://placehold.co/40x40/333/FFF?text=L" class="w-10 h-10 rounded-full"><div><p class="text-xs font-bold text-gray-900">Luana M.</p><p class="text-sm text-gray-600 mt-1">"O final do capítulo 12 me destruiu!"</p></div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `,
            about: `
                <div class="animate-fade-in pb-20">
                    <div class="text-center mb-16 pt-10">
                        <h2 class="text-5xl md:text-6xl font-black text-primary mb-4 font-serif">Quem escreve?</h2>
                        <p id="author-role-display" class="text-gray-500 text-lg">Um pouco da loucura por trás dos livros.</p>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 items-start">
                        
                        <div class="relative group cursor-pointer">
                            <img id="about-main-img" src="" class="rounded-2xl shadow-2xl w-full object-cover h-[600px] grayscale group-hover:grayscale-0 transition duration-700">
                            
                            <div class="absolute -bottom-10 -right-5 md:-right-10 w-64 polaroid bg-white p-3 pb-12 shadow-2xl rounded transform rotate-3 group-hover:rotate-6 transition duration-500 z-20">
                                <div class="tape -top-3 left-1/2 -translate-x-1/2"></div>
                                <img id="about-sec-img" src="" class="w-full h-48 object-cover rounded-sm mb-2 shadow-inner">
                                <p id="about-sec-caption" class="text-center font-hand text-2xl text-gray-700 -rotate-1 text-shadow-sm"></p>
                            </div>
                        </div>

                        <div class="space-y-10 pt-10">
                            <div>
                                <h3 id="about-name-display" class="text-3xl font-bold text-primary font-serif mb-6"></h3>
                                <div id="about-bio-display" class="prose text-gray-600 leading-loose text-lg text-justify"></div>
                            </div>

                            <div>
                                <h4 class="font-bold text-accent uppercase tracking-widest text-xs mb-6">Minha Jornada</h4>
                                <div id="about-timeline-list" class="border-l-2 border-gray-200 pl-8 space-y-10 mt-4 relative">
                                    </div>
                            </div>
                        </div>
                    </div>
                </div>
            `,
            login: `
                <div class="flex items-center justify-center min-h-[60vh] animate-fade-in">
                    <div class="bg-white p-10 rounded-2xl shadow-2xl w-full max-w-md border border-gray-100 relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-primary to-accent"></div>
                        <div class="text-center mb-8">
                            <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4 text-primary text-3xl"><i class="ph-fill ph-lock-key"></i></div>
                            <h2 class="text-2xl font-bold text-primary font-serif">Acesso Restrito</h2>
                        </div>
                        <form onsubmit="event.preventDefault(); window.app.handleLogin()">
                            <div class="space-y-4">
                                <input type="email" id="email" placeholder="E-mail" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-3 form-input" value="admin@ronaldo.com">
                                <input type="password" id="password" placeholder="Senha" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-3 form-input" value="admin">
                                <button class="w-full bg-primary text-white font-bold py-3 rounded-lg hover:bg-accent transition shadow-lg">Entrar no Painel</button>
                            </div>
                        </form>
                    </div>
                </div>
            `,    

        dashboard: `
                <div class="animate-fade-in">
                    <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                        <div>
                            <h2 class="text-3xl font-bold text-primary font-serif">Painel do Escritor</h2>
                            <p class="text-gray-500">Gestão completa de Produtos e Serviços.</p>
                        </div>
                        <div class="flex gap-3 w-full md:w-auto">
                            <button onclick="window.app.openAboutConfigModal()" class="flex-1 md:flex-none flex items-center justify-center gap-2 bg-white border border-gray-200 text-primary px-5 py-2.5 rounded-lg hover:border-accent hover:text-accent transition font-bold text-sm shadow-sm"><i class="ph-bold ph-user-gear"></i> Editar Bio</button>
                            <button onclick="window.app.openHomeConfigModal()" class="flex-1 md:flex-none flex items-center justify-center gap-2 bg-gradient-to-r from-primary to-slate-800 text-white px-5 py-2.5 rounded-lg hover:shadow-lg hover:-translate-y-0.5 transition font-bold text-sm"><i class="ph-bold ph-house-line"></i> Personalizar Home</button>
                            <button onclick="window.app.logout()" class="flex items-center gap-2 bg-red-50 text-red-600 px-4 py-2 rounded-lg hover:bg-red-100 transition font-bold text-sm"><i class="ph ph-sign-out"></i> Sair</button>
                        </div>
                    </div>

                    <div class="flex gap-6 border-b border-gray-200 mb-8">
                        <button onclick="window.app.setAdminTab('main')" id="tab-main" class="pb-3 text-sm font-bold border-b-2 border-accent text-accent transition">Visão Geral & Cruds</button>
                        <button onclick="window.app.setAdminTab('analytics')" id="tab-analytics" class="pb-3 text-sm font-bold border-b-2 border-transparent text-gray-400 hover:text-primary transition">Relatórios & Tráfego</button>
                        <button onclick="window.app.setAdminTab('leads')" id="tab-leads" class="pb-3 text-sm font-bold border-b-2 border-transparent text-gray-400 hover:text-primary transition flex items-center gap-2">Solicitações <span id="badge-leads" class="bg-red-500 text-white text-[10px] px-1.5 rounded-full hidden">0</span></button>
                    </div>

                    <div id="dashboard-content"></div>
                    <div class="h-20"></div>
                </div>
            `,
        
        };

        // ==========================================
        // 2. DADOS & ESTADO
        // ==========================================
        const DB = {

        // Adicione isso dentro do DB, logo após 'comments: [...]'
            leads: [
                { id: 1, name: "Fernanda Costa", email: "fer.costa@email.com", service: "Mentoria Literária", desc: "Tenho um manuscrito de 300 páginas...", date: "12/12/2025", status: "pending" },
                { id: 2, name: "Roberto Silva", email: "beto@email.com", service: "Design de Capa", desc: "Capa para Sci-Fi cyberpunk.", date: "11/12/2025", status: "archived" }
            ],
            stats: {
                totalVisits: 15420,
                clicksAmazon: 842,
                clicksML: 320,
                clicksShopee: 510,
                mostViewedBook: "O Código da Eternidade"
            },
            homeConfig: {
                    heroBookId: '1',
                    showLaunchBadge: true,
                    highlights: ['1', 'S3'],
                    quote: {
                        text: "Escrever é a única forma que encontrei de viver mil vidas em uma só. E convido você a viver elas comigo.",
                        author: "Ronaldo Pereira"
                    }
                },
            author: { 
                name: "Ronaldo Pereira", 
                role: "Escritor de Ficção Especulativa", 
                avatar: "https://placehold.co/600x800/1e293b/FFF?text=Autor+Pro",
                bio: "Olá! Sou o Ronaldo. Minha jornada começou devorando livros na biblioteca. Hoje, dedico minha vida a criar histórias que misturam tecnologia, magia e a complexidade humana.",
                secondaryImage: "https://placehold.co/300x300/d97706/FFF?text=Família",
                secondaryCaption: "Meu porto seguro ❤️",
                timeline: [
                    { year: "2015", title: "O Início", desc: "Publiquei meu primeiro conto em um blog gratuito." },
                    { year: "2018", title: "Primeiro Prêmio", desc: "Vencedor do concurso nacional de Novos Talentos." },
                    { year: "2025", title: "Carreira Sólida", desc: "Mais de 10 mil cópias vendidas digitalmente." }
                ]
            },
            books: [], 
            services: [
                { 
                    id: 'S1', name: 'Design de Capa', price: 800.00, active: true, isPromotion: false, promoPrice: null, unit: '', 
                    description: 'Capa impactante focada em vendas. Identidade visual completa.',
                    icon: 'ph-paint-brush-broad',
                    theme: 'purple'
                },
                { 
                    id: 'S2', name: 'Revisão Textual', price: 0.05, active: true, isPromotion: true, promoPrice: 0.03, unit: 'p/ palavra', 
                    description: 'Correção ortográfica, gramatical e de coerência.',
                    icon: 'ph-text-aa',
                    theme: 'blue'
                },
                { 
                    id: 'S3', name: 'Mentoria Literária', price: 500.00, active: false, isPromotion: false, promoPrice: null, 
                    description: 'Sessões de 1h30 para desbloquear sua escrita e planejar sua carreira.',
                    icon: 'ph-student',
                    theme: 'orange'
                }
            ],
            posts: [
                { id: 1, title: "Como venci o bloqueio criativo", date: "2 dias atrás", category: "Escrita", image: "https://placehold.co/600x300/1e293b/FFF?text=Bloqueio", likes: 142, comments: 23 },
                { id: 2, title: "O futuro da Ficção no Brasil", date: "1 sem atrás", category: "Opinião", image: "https://placehold.co/600x300/d97706/FFF?text=SciFi", likes: 89, comments: 45 }
            ],
            comments: [
                { id: 1, user: "Carlos M.", avatar: "https://placehold.co/40x40/333/FFF?text=C", text: "Achei o plot twist final genial!", date: "Há 2 horas" },
                { id: 2, user: "Ana Clara", avatar: "https://placehold.co/40x40/555/FFF?text=A", text: "Alguém mais notou a referência no cap 4?", date: "Há 5 horas" }
            ]
        };

        // BIBLIOTECA DE ÍCONES PARA O SELETOR
        const ICON_LIBRARY = [
            'ph-pencil-simple', 'ph-pen-nib', 'ph-book-open', 'ph-book-bookmark', 'ph-notebook',
            'ph-magic-wand', 'ph-sparkle', 'ph-star', 'ph-crown', 'ph-medal',
            'ph-lightbulb', 'ph-lightning', 'ph-fire', 'ph-rocket', 'ph-airplane-tilt',
            'ph-chat-circle-text', 'ph-quotes', 'ph-translate', 'ph-microphone', 'ph-video-camera',
            'ph-user', 'ph-users', 'ph-student', 'ph-chalkboard-teacher', 'ph-briefcase',
            'ph-paint-brush', 'ph-palette', 'ph-image', 'ph-camera', 'ph-crop',
            'ph-check-circle', 'ph-shield-check', 'ph-lock-key', 'ph-key', 'ph-fingerprint',
            'ph-chart-line-up', 'ph-target', 'ph-trophy', 'ph-money', 'ph-credit-card'
        ];

        // DEFINIÇÃO DE TEMAS (Visualmente agradáveis e acessíveis)
        const THEMES = {
            'default': { name: 'Midnight', bg: 'bg-slate-50', border: 'border-slate-200', text: 'text-slate-700', dot: 'bg-slate-800' },
            'orange':  { name: 'Sunset',   bg: 'bg-orange-50', border: 'border-orange-200', text: 'text-orange-800', dot: 'bg-orange-500' },
            'blue':    { name: 'Ocean',    bg: 'bg-blue-50',   border: 'border-blue-200',   text: 'text-blue-800',   dot: 'bg-blue-600' },
            'purple':  { name: 'Royal',    bg: 'bg-purple-50', border: 'border-purple-200', text: 'text-purple-800', dot: 'bg-purple-600' },
            'green':   { name: 'Forest',   bg: 'bg-emerald-50', border: 'border-emerald-200', text: 'text-emerald-800', dot: 'bg-emerald-600' },
            'red':     { name: 'Passion',  bg: 'bg-rose-50',    border: 'border-rose-200',    text: 'text-rose-800',    dot: 'bg-rose-600' },
        };
        // Gerador de Livros Mock   
        function generateBooks() {
            const covers = ['1e293b', 'd97706', '475569', '0f766e', 'be123c', '4338ca'];
            const genres = ['Ficção Científica', 'Fantasia', 'Thriller', 'Terror', 'Drama'];
            
            for(let i=1; i<=6; i++) {
                const price = 29.90 + (i * 2);
                DB.books.push({
                    id: i.toString(),
                    title: i === 1 ? 'O Código da Eternidade' : `Crônicas de Gelo e Fogo Vol.${i}`, // Título maior para testar efeito
                    genre: genres[i % genres.length],
                    price: price,
                    active: true, 
                    isPromotion: i % 2 === 0, 
                    promoPrice: i % 2 === 0 ? (price * 0.7) : null,
                    cover: `https://placehold.co/300x450/${covers[i % covers.length]}/FFF?text=Vol.${i}`,
                    synopsis: "Sinopse padrão gerada pelo sistema para detalhamento...",
                    // NOVO CAMPO:
                    coverSynopsis: "Uma jornada épica que está conquistando o Brasil. Explore o impossível agora.",
                    linkAmazon: '#', linkML: '#', linkShopee: '#'
                });
            }
        }
        generateBooks();

        const adminState = {
            currentTab: 'main', // 'main' (SEU DASH ORIGINAL), 'analytics', 'leads'
            books: { page: 1, filter: '', sortKey: 'title', sortOrder: 'asc' }, 
            services: { page: 1, filter: '', sortKey: 'name', sortOrder: 'asc' },
            itemsPerPage: 5
        };

        
        // ESTADO GLOBAL SIMPLIFICADO
        let favorites = JSON.parse(localStorage.getItem('user_favorites')) || []; 
        let user = JSON.parse(localStorage.getItem('user')) || null;
        let isAdmin = localStorage.getItem('isAdmin') === 'true';
        let currentPage = 1;
        const itemsPerPage = 6;

        // ==========================================
        // 3. LÓGICA DO APP (ROUTER & CONTROLLERS)
        // ==========================================
        
        function router() {
            const hash = window.location.hash || '#/';
            const app = document.getElementById('app');
            let pageKey = 'home';

            if(hash === '#/') pageKey = 'home';
            else if(hash.startsWith('#/livro/')) pageKey = 'book_details';
            else if(hash.includes('livros')) pageKey = 'livros';
            else if(hash.includes('servicos')) pageKey = 'servicos';
            else if(hash.includes('autor')) pageKey = 'about';
            else if(hash.includes('comunidade')) pageKey = 'community';
            else if(hash.includes('painel')) pageKey = isAdmin ? 'dashboard' : 'login';

            app.innerHTML = TEMPLATES[pageKey];
            window.scrollTo(0, 0);
            
            if(pageKey === 'home') initHome();
            if(pageKey === 'livros') { currentPage = 1; initLivros(); }
            if(pageKey === 'book_details') { const id = hash.split('/')[2]; initBookDetails(id); }
            if(pageKey === 'servicos') initServicos();
            if(pageKey === 'about') initAbout();
            if(pageKey === 'community') initCommunity();
            if(pageKey === 'dashboard') initDashboard();
            
            const menu = document.getElementById('mobile-menu');
            if(menu) menu.classList.add('hidden');
        }

        function showToast(message, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            const color = type === 'success' ? 'bg-green-600' : 'bg-red-600';
            const icon = type === 'success' ? 'ph-check-circle' : 'ph-warning-circle';
            toast.className = `${color} text-white px-6 py-4 rounded-xl shadow-2xl flex items-center gap-3 transform translate-x-full transition-all duration-500 pointer-events-auto min-w-[300px]`;
            toast.innerHTML = `<i class="ph-fill ${icon} text-xl"></i> <span class="font-bold text-sm">${message}</span>`;
            container.appendChild(toast);
            requestAnimationFrame(() => toast.classList.remove('translate-x-full'));
            setTimeout(() => { toast.classList.add('opacity-0', 'translate-x-full'); setTimeout(() => toast.remove(), 500); }, 3000);
        }

        // --- CONTROLLERS ---

        // Substitua a função initBookDetails atual por esta:
        function initBookDetails(id) {
            const book = DB.books.find(b => b.id === id);
            if(!book) { window.location.hash = '#/livros'; return; }
            
            // Dados Básicos
            document.getElementById('detail-img').src = book.cover;
            document.getElementById('detail-title').innerText = book.title;
            document.getElementById('detail-genre').innerText = book.genre;
            
            // Sinopse
            const synopsisContainer = document.querySelector('.prose');
            if(synopsisContainer) {
                synopsisContainer.innerHTML = (book.synopsis || '').split('\n').map(p => `<p>${p}</p>`).join('');
            }

            // Lógica de Preço e Promoção
            const promoBadge = document.querySelector('.absolute.top-5.right-5');
            const promoBanner = document.querySelector('.bg-gradient-to-r.from-orange-100');
            const priceContainer = document.getElementById('detail-price').parentNode;

            if (book.isPromotion && book.promoPrice) {
                if(promoBadge) promoBadge.classList.remove('hidden');
                if(promoBanner) promoBanner.classList.remove('hidden');
                
                // Exibe Preço Promocional Grande e o Original riscado
                const discount = Math.round(((book.price - book.promoPrice) / book.price) * 100);
                priceContainer.innerHTML = `
                    <div class="text-4xl font-black text-primary" id="detail-price">R$ ${book.promoPrice.toFixed(2)}</div>
                    <p class="text-sm text-gray-400 pb-2 decoration-slice line-through decoration-red-500 decoration-2">De R$ ${book.price.toFixed(2)}</p>
                    <span class="bg-green-100 text-green-800 text-xs font-bold px-2 py-1 rounded mb-2">${discount}% OFF</span>
                `;
            } else {
                if(promoBadge) promoBadge.classList.add('hidden');
                if(promoBanner) promoBanner.classList.add('hidden');
                
                // Exibe apenas preço normal
                priceContainer.innerHTML = `
                    <div class="text-4xl font-black text-primary" id="detail-price">R$ ${book.price.toFixed(2)}</div>
                `;
            }
            
            // Links e Favoritos (Mantido igual)
            document.getElementById('link-amazon').href = book.linkAmazon || '#';
            document.getElementById('link-ml').href = book.linkML || '#';
            document.getElementById('link-shopee').href = book.linkShopee || '#';

            const favBtn = document.getElementById('detail-fav-btn'); 
            const favIcon = document.getElementById('detail-fav-icon');
            const updateState = () => {
                if(favorites.includes(book.id)) {
                    favIcon.className = "ph-fill ph-heart text-xl text-red-500";
                    favIcon.classList.remove('text-gray-300');
                } else {
                    favIcon.className = "ph-fill ph-heart text-xl text-gray-300";
                }
            };
            favBtn.onclick = () => { window.app.toggleFavorite(book.id); updateState(); };
            updateState();
        }

        function initDashboard() {
                    const content = document.getElementById('dashboard-content');
                    if(!content) return;

                    // 1. Atualiza visual dos botões das abas
                    ['main', 'analytics', 'leads'].forEach(t => {
                        const btn = document.getElementById(`tab-${t}`);
                        if(btn) {
                            if(adminState.currentTab === t) btn.className = "pb-3 text-sm font-bold border-b-2 border-accent text-primary transition";
                            else btn.className = "pb-3 text-sm font-bold border-b-2 border-transparent text-gray-400 hover:text-primary transition";
                        }
                    });

                    // Badge de Leads
                    const pending = DB.leads.filter(l => l.status === 'pending').length;
                    const badge = document.getElementById('badge-leads');
                    if(badge) { badge.innerText = pending; badge.classList.toggle('hidden', pending === 0); }

                    // 2. LÓGICA DE RENDERIZAÇÃO DAS ABAS
                    if (adminState.currentTab === 'main') {
                        content.innerHTML = `
                            <div class="animate-fade-in">
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-10">
                                    <div class="dashboard-card border-l-4 border-accent">
                                        <p class="text-gray-400 text-xs font-bold uppercase tracking-wide mb-1">Faturamento (Livros)</p>
                                        <h3 class="text-3xl font-black text-primary">R$ 14.502</h3>
                                    </div>
                                    <div class="dashboard-card border-l-4 border-blue-500">
                                        <p class="text-gray-400 text-xs font-bold uppercase tracking-wide mb-1">Faturamento (Serviços)</p>
                                        <h3 class="text-3xl font-black text-primary">R$ 5.200</h3>
                                    </div>
                                    <div class="dashboard-card">
                                        <p class="text-gray-400 text-xs font-bold uppercase tracking-wide mb-1">Leads Totais</p>
                                        <h3 class="text-3xl font-black text-primary">1.205</h3>
                                    </div>
                                    <div class="dashboard-card">
                                        <p class="text-gray-400 text-xs font-bold uppercase tracking-wide mb-1">Solicitações Pendentes</p>
                                        <h3 class="text-3xl font-black text-accent">${pending}</h3>
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 gap-12">
                                    
                                    <div class="dashboard-card">
                                        <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                                            <div><h3 class="font-bold text-lg text-primary flex items-center gap-2"><i class="ph-fill ph-book text-accent"></i> Catálogo de Livros</h3></div>
                                            <div class="flex gap-2 flex-1 justify-end w-full md:w-auto">
                                                <input type="text" placeholder="Buscar livro..." oninput="window.app.setAdminFilter('books', 'filter', this.value)" class="bg-gray-50 border border-gray-200 rounded-lg text-xs p-2 w-full md:w-64 focus:outline-none focus:border-accent">
                                                <button onclick="window.app.openBookModal()" class="text-white bg-primary px-4 py-2 rounded-lg text-xs font-bold uppercase hover:bg-accent transition shadow-lg flex items-center gap-2 whitespace-nowrap"><i class="ph-bold ph-plus"></i> Novo</button>
                                            </div>
                                        </div>
                                        <div class="overflow-x-auto min-h-[300px]">
                                            <table class="w-full text-left text-sm text-gray-600">
                                                <thead class="bg-gray-50 text-gray-400 uppercase text-xs border-b border-gray-200">
                                                    <tr>
                                                        <th class="p-3">Capa</th>
                                                        <th class="p-3 cursor-pointer hover:text-primary transition select-none group" onclick="window.app.sortData('books', 'title')">
                                                            Título <i id="sort-books-title" class="ph-bold ph-arrows-down-up text-gray-300 group-hover:text-primary ml-1 align-middle"></i>
                                                        </th>
                                                        <th class="p-3 cursor-pointer hover:text-primary transition select-none group" onclick="window.app.sortData('books', 'price')">
                                                            Preço <i id="sort-books-price" class="ph-bold ph-arrows-down-up text-gray-300 group-hover:text-primary ml-1 align-middle"></i>
                                                        </th>
                                                        <th class="p-3 text-center cursor-pointer hover:text-primary transition select-none group" onclick="window.app.sortData('books', 'isPromotion')">
                                                            Promoção <i id="sort-books-isPromotion" class="ph-bold ph-arrows-down-up text-gray-300 group-hover:text-primary ml-1 align-middle"></i>
                                                        </th>
                                                        <th class="p-3 text-center cursor-pointer hover:text-primary transition select-none group" onclick="window.app.sortData('books', 'active')">
                                                            Status <i id="sort-books-active" class="ph-bold ph-arrows-down-up text-gray-300 group-hover:text-primary ml-1 align-middle"></i>
                                                        </th>
                                                        <th class="p-3 text-right">Ação</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="admin-books-table"></tbody>
                                            </table>
                                        </div>
                                        <div class="flex justify-between items-center border-t border-gray-100 pt-4 mt-4"><span class="text-xs text-gray-400" id="admin-books-info"></span><div class="flex gap-2" id="admin-books-pagination"></div></div>
                                    </div>

                                    <div class="dashboard-card border-t-4 border-blue-500">
                                        <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                                            <div><h3 class="font-bold text-lg text-primary flex items-center gap-2"><i class="ph-fill ph-briefcase text-blue-500"></i> Meus Serviços</h3></div>
                                            <div class="flex gap-2 flex-1 justify-end w-full md:w-auto">
                                                <input type="text" placeholder="Buscar serviço..." oninput="window.app.setAdminFilter('services', 'filter', this.value)" class="bg-gray-50 border border-gray-200 rounded-lg text-xs p-2 w-full md:w-64 focus:outline-none focus:border-blue-500">
                                                <button onclick="window.app.openServiceEditModal()" class="text-white bg-blue-600 px-4 py-2 rounded-lg text-xs font-bold uppercase hover:bg-blue-700 transition shadow-lg flex items-center gap-2 whitespace-nowrap"><i class="ph-bold ph-plus"></i> Novo</button>
                                            </div>
                                        </div>
                                        <div class="overflow-x-auto min-h-[200px]">
                                            <table class="w-full text-left text-sm text-gray-600">
                                                <thead class="bg-blue-50 text-blue-400 uppercase text-xs border-b border-blue-100">
                                                    <tr>
                                                        <th class="p-3 cursor-pointer hover:text-blue-700 transition select-none group" onclick="window.app.sortData('services', 'name')">
                                                            Serviço <i id="sort-services-name" class="ph-bold ph-arrows-down-up text-blue-300 group-hover:text-blue-700 ml-1 align-middle"></i>
                                                        </th>
                                                        <th class="p-3 cursor-pointer hover:text-blue-700 transition select-none group" onclick="window.app.sortData('services', 'price')">
                                                            Preço Base <i id="sort-services-price" class="ph-bold ph-arrows-down-up text-blue-300 group-hover:text-blue-700 ml-1 align-middle"></i>
                                                        </th>
                                                        <th class="p-3 text-center cursor-pointer hover:text-blue-700 transition select-none group" onclick="window.app.sortData('services', 'isPromotion')">
                                                            Promoção <i id="sort-services-isPromotion" class="ph-bold ph-arrows-down-up text-blue-300 group-hover:text-blue-700 ml-1 align-middle"></i>
                                                        </th>
                                                        <th class="p-3 text-center cursor-pointer hover:text-blue-700 transition select-none group" onclick="window.app.sortData('services', 'active')">
                                                            Status <i id="sort-services-active" class="ph-bold ph-arrows-down-up text-blue-300 group-hover:text-blue-700 ml-1 align-middle"></i>
                                                        </th>
                                                        <th class="p-3 text-right">Ação</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="admin-services-table"></tbody>
                                            </table>
                                        </div>
                                        <div class="flex justify-between items-center border-t border-gray-100 pt-4 mt-4"><span class="text-xs text-gray-400" id="admin-services-info"></span><div class="flex gap-2" id="admin-services-pagination"></div></div>
                                    </div>
                                </div>
                            </div>`;
                        
                        // --- HELPER DE ORDENAÇÃO ---
                        const sortList = (list, key, order) => {
                            return list.sort((a, b) => {
                                let valA = a[key]; let valB = b[key];
                                if (typeof valA === 'string') valA = valA.toLowerCase();
                                if (typeof valB === 'string') valB = valB.toLowerCase();
                                if (valA < valB) return order === 'asc' ? -1 : 1;
                                if (valA > valB) return order === 'asc' ? 1 : -1;
                                return 0;
                            });
                        };
                        
                        // --- HELPER DE ÍCONES DE ORDENAÇÃO ---
                        const updateIcons = (context, activeKey, activeOrder) => {
                            const keys = context === 'books' ? ['title', 'price', 'isPromotion', 'active'] : ['name', 'price', 'isPromotion', 'active'];
                            keys.forEach(k => {
                                const el = document.getElementById(`sort-${context}-${k}`);
                                if(el) {
                                    if(k === activeKey) { el.className = `ph-bold ${activeOrder === 'asc' ? 'ph-caret-up' : 'ph-caret-down'} text-accent align-middle ml-1`; } 
                                    else { el.className = `ph-bold ph-arrows-down-up text-gray-300 group-hover:text-gray-500 align-middle ml-1`; }
                                }
                            });
                        };

                        // --- RENDERIZAÇÃO DA TABELA DE LIVROS (CORRIGIDA) ---
                        const renderBooks = () => {
                            let list = DB.books.filter(b => b.title.toLowerCase().includes(adminState.books.filter.toLowerCase()));
                            list = sortList(list, adminState.books.sortKey, adminState.books.sortOrder);
                            updateIcons('books', adminState.books.sortKey, adminState.books.sortOrder);
                            
                            const start = (adminState.books.page - 1) * adminState.itemsPerPage;
                            const paged = list.slice(start, start + adminState.itemsPerPage);
                            const tbody = document.getElementById('admin-books-table');
                            
                            if(tbody) {
                                if(paged.length === 0) tbody.innerHTML = `<tr><td colspan="6" class="p-8 text-center text-gray-400">Nenhum livro encontrado.</td></tr>`;
                                else {
                                    tbody.innerHTML = paged.map(b => `
                                        <tr class="border-b border-gray-100 hover:bg-gray-50 transition group ${b.active ? '' : 'opacity-60 bg-gray-50'}">
                                            <td class="p-3"><img src="${b.cover}" class="w-10 h-14 object-cover rounded shadow-sm"></td>
                                            <td class="p-3 font-bold text-primary">${b.title}</td>
                                            <td class="p-3 text-gray-500">
                                                ${b.isPromotion && b.promoPrice ? 
                                                    `<div class="flex flex-col"><span class="line-through text-xs text-gray-400">R$ ${b.price}</span><span class="text-green-600 font-bold">R$ ${b.promoPrice}</span></div>` : 
                                                    `R$ ${b.price.toFixed(2)}`
                                                }
                                            </td>
                                            <td class="p-3 text-center">
                                                ${b.isPromotion ? 
                                                    '<span class="text-[10px] bg-orange-50 text-orange-700 border border-orange-200 px-2 py-0.5 rounded font-bold">SIM</span>' : 
                                                    '<span class="text-[10px] text-gray-300">-</span>'
                                                }
                                            </td>
                                            <td class="p-3 text-center">
                                                <span class="inline-flex items-center gap-1.5 text-xs font-bold px-2 py-1 rounded-full ${b.active ? 'bg-green-100 text-green-700 border border-green-200' : 'bg-gray-100 text-gray-500 border border-gray-200'}">
                                                    <span class="w-1.5 h-1.5 rounded-full ${b.active ? 'bg-green-500' : 'bg-gray-400'}"></span>
                                                    ${b.active ? 'Ativo' : 'Inativo'}
                                                </span>
                                            </td>
                                            <td class="p-3 text-right">
                                                <button onclick="window.app.openBookModal('${b.id}')" class="text-blue-500 hover:bg-blue-50 p-2 rounded-full transition"><i class="ph-bold ph-pencil-simple"></i></button>
                                                <button onclick="window.app.deleteBook('${b.id}')" class="text-red-400 hover:bg-red-50 p-2 rounded-full transition"><i class="ph-bold ph-trash"></i></button>
                                            </td>
                                        </tr>`).join('');
                                }
                            }
                            // Paginação Livros
                            const pages = Math.ceil(list.length / adminState.itemsPerPage);
                            document.getElementById('admin-books-info').innerText = `Mostrando ${paged.length} de ${list.length}`;
                            let nav = '';
                            if(pages > 1) {
                                nav += `<button onclick="window.app.changeAdminPage('books', -1)" class="w-8 h-8 rounded border hover:bg-gray-100 flex items-center justify-center" ${adminState.books.page === 1 ? 'disabled opacity-50' : ''}><i class="ph-bold ph-caret-left"></i></button>`;
                                nav += `<span class="text-xs font-bold px-2 self-center">Pág ${adminState.books.page} / ${pages}</span>`;
                                nav += `<button onclick="window.app.changeAdminPage('books', 1)" class="w-8 h-8 rounded border hover:bg-gray-100 flex items-center justify-center" ${adminState.books.page === pages ? 'disabled opacity-50' : ''}><i class="ph-bold ph-caret-right"></i></button>`;
                            }
                            document.getElementById('admin-books-pagination').innerHTML = nav;
                        };

                        // --- RENDERIZAÇÃO DA TABELA DE SERVIÇOS (CORRIGIDA) ---
                        const renderServices = () => {
                            let list = DB.services.filter(s => s.name.toLowerCase().includes(adminState.services.filter.toLowerCase()));
                            list = sortList(list, adminState.services.sortKey, adminState.services.sortOrder);
                            updateIcons('services', adminState.services.sortKey, adminState.services.sortOrder);

                            const start = (adminState.services.page - 1) * adminState.itemsPerPage;
                            const paged = list.slice(start, start + adminState.itemsPerPage);
                            const tbody = document.getElementById('admin-services-table');

                            if(tbody) {
                                if(paged.length === 0) tbody.innerHTML = `<tr><td colspan="5" class="p-8 text-center text-gray-400">Nenhum serviço encontrado.</td></tr>`;
                                else {
                                    tbody.innerHTML = paged.map(s => {
                                        const theme = THEMES[s.theme || 'default'];
                                        return `
                                        <tr class="border-b ${theme.border} hover:bg-opacity-80 transition ${s.active ? theme.bg : 'opacity-60 bg-gray-50'}">
                                            <td class="p-3">
                                                <div class="flex items-center gap-3">
                                                    <div class="w-10 h-10 rounded-lg bg-white/60 flex items-center justify-center shadow-sm text-xl ${theme.text}">
                                                        <i class="ph-fill ${s.icon || 'ph-star-four'}"></i>
                                                    </div>
                                                    <div>
                                                        <div class="font-bold text-gray-800">${s.name}</div>
                                                        <div class="text-xs ${theme.text} opacity-80 truncate max-w-[150px]">${s.description}</div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="p-3 font-mono text-sm ${theme.text}">
                                                ${s.isPromotion && s.promoPrice ? 
                                                    `<span class="line-through text-xs opacity-60 mr-1">R$ ${s.price}</span><span class="font-bold">R$ ${s.promoPrice}</span>` : 
                                                    `R$ ${s.price.toFixed(2)}`
                                                }
                                                <span class="text-[10px] opacity-60 font-sans font-normal ml-1 block">${s.unit || ''}</span>
                                            </td>
                                            <td class="p-3 text-center">
                                                ${s.isPromotion ? 
                                                    '<span class="text-[10px] bg-white text-orange-600 border border-orange-200 px-2 py-0.5 rounded font-bold shadow-sm">SIM</span>' : 
                                                    '<span class="text-[10px] text-gray-400">-</span>'
                                                }
                                            </td>
                                            <td class="p-3 text-center">
                                                <span class="inline-flex items-center gap-1.5 text-xs font-bold px-2 py-1 rounded-full bg-white/60 border ${theme.border} text-gray-600">
                                                    <span class="w-1.5 h-1.5 rounded-full ${s.active ? 'bg-green-500' : 'bg-gray-400'}"></span>
                                                    ${s.active ? 'Ativo' : 'Inativo'}
                                                </span>
                                            </td>
                                            <td class="p-3 text-right flex justify-end gap-2">
                                                <button onclick="window.app.openServiceEditModal('${s.id}')" class="text-blue-500 hover:bg-blue-100 p-2 rounded-full transition"><i class="ph-bold ph-pencil-simple"></i></button>
                                                <button onclick="window.app.deleteService('${s.id}')" class="text-red-400 hover:bg-red-100 p-2 rounded-full transition"><i class="ph-bold ph-trash"></i></button>
                                            </td>
                                        </tr>
                                    `}).join('');
                                }
                            }
                            // Paginação Serviços
                            const pages = Math.ceil(list.length / adminState.itemsPerPage);
                            document.getElementById('admin-services-info').innerText = `Mostrando ${paged.length} de ${list.length}`;
                            let nav = '';
                            if(pages > 1) {
                                nav += `<button onclick="window.app.changeAdminPage('services', -1)" class="w-8 h-8 rounded border hover:bg-gray-100 flex items-center justify-center" ${adminState.services.page === 1 ? 'disabled opacity-50' : ''}><i class="ph-bold ph-caret-left"></i></button>`;
                                nav += `<span class="text-xs font-bold px-2 self-center">Pág ${adminState.services.page} / ${pages}</span>`;
                                nav += `<button onclick="window.app.changeAdminPage('services', 1)" class="w-8 h-8 rounded border hover:bg-gray-100 flex items-center justify-center" ${adminState.services.page === pages ? 'disabled opacity-50' : ''}><i class="ph-bold ph-caret-right"></i></button>`;
                            }
                            document.getElementById('admin-services-pagination').innerHTML = nav;
                        };

                        // Executa a renderização inicial
                        renderBooks();
                        renderServices();

                    } else if (adminState.currentTab === 'analytics') {
                        const total = DB.stats.clicksAmazon + DB.stats.clicksML + DB.stats.clicksShopee;
                        content.innerHTML = `
                            <div class="animate-fade-in grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div class="bg-white p-8 rounded-2xl shadow-sm border border-gray-100">
                                    <h3 class="font-bold text-primary mb-6">Tráfego por Loja</h3>
                                    <div class="space-y-4">
                                        <div><div class="flex justify-between text-xs font-bold mb-1"><span>Amazon</span><span>${DB.stats.clicksAmazon}</span></div><div class="w-full bg-gray-100 h-2 rounded-full"><div class="bg-[#FF9900] h-2 rounded-full" style="width: ${(DB.stats.clicksAmazon/total*100)||0}%"></div></div></div>
                                        <div><div class="flex justify-between text-xs font-bold mb-1"><span>Mercado Livre</span><span>${DB.stats.clicksML}</span></div><div class="w-full bg-gray-100 h-2 rounded-full"><div class="bg-[#FFE600] h-2 rounded-full" style="width: ${(DB.stats.clicksML/total*100)||0}%"></div></div></div>
                                        <div><div class="flex justify-between text-xs font-bold mb-1"><span>Shopee</span><span>${DB.stats.clicksShopee}</span></div><div class="w-full bg-gray-100 h-2 rounded-full"><div class="bg-[#EE4D2D] h-2 rounded-full" style="width: ${(DB.stats.clicksShopee/total*100)||0}%"></div></div></div>
                                    </div>
                                </div>
                                <div class="bg-primary p-8 rounded-2xl shadow-lg text-white">
                                    <h3 class="font-serif text-2xl font-bold mb-4">Livro em Alta</h3>
                                    <p class="text-4xl font-black text-accent mb-2">"${DB.stats.mostViewedBook}"</p>
                                    <p class="text-slate-400 text-sm">Este livro recebeu 45% de todos os cliques esta semana.</p>
                                </div>
                            </div>`;

                    } else if (adminState.currentTab === 'leads') {
                        const list = DB.leads;
                        content.innerHTML = `
                            <div class="animate-fade-in bg-white rounded-2xl shadow-sm border border-gray-200 p-6">
                                <h3 class="font-bold text-lg text-primary mb-6">Pedidos de Orçamento</h3>
                                <div class="space-y-4">
                                    ${list.length ? list.map(l => `
                                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center p-4 bg-gray-50 rounded-xl border border-gray-100 ${l.status==='pending'?'border-l-4 border-l-red-500':''}">
                                            <div>
                                                <div class="flex items-center gap-2"><span class="font-bold text-gray-800">${l.name}</span> <span class="text-xs text-gray-400">(${l.email})</span></div>
                                                <div class="text-xs font-bold text-accent uppercase mt-1">${l.service}</div>
                                                <p class="text-sm text-gray-600 italic mt-2">"${l.desc}"</p>
                                            </div>
                                            <div class="mt-4 md:mt-0 flex gap-2">
                                                <a href="mailto:${l.email}" class="text-xs font-bold bg-white border border-gray-200 px-3 py-2 rounded hover:text-primary transition">Responder</a>
                                                ${l.status==='pending' ? `<button onclick="window.app.archiveLead(${l.id})" class="text-xs font-bold bg-green-100 text-green-700 px-3 py-2 rounded hover:bg-green-200 transition">Baixa</button>` : '<span class="text-xs text-gray-400 px-3 py-2">Arquivado</span>'}
                                            </div>
                                        </div>
                                    `).join('') : '<p class="text-gray-400 p-4 text-center">Nenhuma solicitação.</p>'}
                                </div>
                            </div>`;
                    }
                }

        function renderBooksTable() {
            let list = DB.books.filter(b => b.title.toLowerCase().includes(adminState.books.filter.toLowerCase()));
            list.sort((a, b) => {
                let vA = a[adminState.books.sortKey], vB = b[adminState.books.sortKey];
                if (typeof vA === 'string') vA = vA.toLowerCase(); if (typeof vB === 'string') vB = vB.toLowerCase();
                if (vA < vB) return adminState.books.sortOrder === 'asc' ? -1 : 1; if (vA > vB) return adminState.books.sortOrder === 'asc' ? 1 : -1; return 0;
            });
            const start = (adminState.books.page - 1) * adminState.itemsPerPage;
            const paged = list.slice(start, start + adminState.itemsPerPage);
            const tbody = document.getElementById('admin-books-table');
            if (tbody) {
                tbody.innerHTML = paged.length ? paged.map(b => `
                    <tr class="border-b border-gray-100 hover:bg-gray-50 transition">
                        <td class="p-3"><img src="${b.cover}" class="w-8 h-12 object-cover rounded"></td>
                        <td class="p-3 font-bold text-primary">${b.title}</td>
                        <td class="p-3">R$ ${b.price.toFixed(2)}</td>
                        <td class="p-3 text-center text-xs">${b.isPromotion ? '✅' : '-'}</td>
                        <td class="p-3 text-center"><span class="w-2 h-2 rounded-full inline-block ${b.active ? 'bg-green-500' : 'bg-gray-300'}"></span></td>
                        <td class="p-3 text-right"><button onclick="window.app.openBookModal('${b.id}')" class="text-blue-500 hover:bg-blue-50 p-2 rounded-full"><i class="ph-bold ph-pencil-simple"></i></button><button onclick="window.app.deleteBook('${b.id}')" class="text-red-400 hover:bg-red-50 p-2 rounded-full"><i class="ph-bold ph-trash"></i></button></td>
                    </tr>`).join('') : '<tr><td colspan="6" class="p-4 text-center text-gray-400">Nenhum livro encontrado.</td></tr>';
                document.getElementById('admin-books-info').innerText = `Mostrando ${paged.length} de ${list.length}`;
            }
        }

        function renderServicesTable() {
            let list = DB.services.filter(s => s.name.toLowerCase().includes(adminState.services.filter.toLowerCase()));
            list.sort((a, b) => {
                let vA = a[adminState.services.sortKey], vB = b[adminState.services.sortKey];
                if (typeof vA === 'string') vA = vA.toLowerCase(); if (typeof vB === 'string') vB = vB.toLowerCase();
                if (vA < vB) return adminState.services.sortOrder === 'asc' ? -1 : 1; if (vA > vB) return adminState.services.sortOrder === 'asc' ? 1 : -1; return 0;
            });
            const start = (adminState.services.page - 1) * adminState.itemsPerPage;
            const paged = list.slice(start, start + adminState.itemsPerPage);
            const tbody = document.getElementById('admin-services-table');
            if (tbody) {
                tbody.innerHTML = paged.length ? paged.map(s => `
                    <tr class="border-b border-blue-100 hover:bg-blue-50 transition">
                        <td class="p-3 font-bold text-gray-700 flex items-center gap-2"><i class="ph-fill ${s.icon} text-blue-500"></i> ${s.name}</td>
                        <td class="p-3">R$ ${s.price}</td>
                        <td class="p-3 text-center text-xs">${s.isPromotion ? '✅' : '-'}</td>
                        <td class="p-3 text-center"><span class="w-2 h-2 rounded-full inline-block ${s.active ? 'bg-green-500' : 'bg-gray-300'}"></span></td>
                        <td class="p-3 text-right"><button onclick="window.app.openServiceEditModal('${s.id}')" class="text-blue-500 hover:bg-blue-100 p-2 rounded-full"><i class="ph-bold ph-pencil-simple"></i></button><button onclick="window.app.deleteService('${s.id}')" class="text-red-400 hover:bg-red-100 p-2 rounded-full"><i class="ph-bold ph-trash"></i></button></td>
                    </tr>`).join('') : '<tr><td colspan="5" class="p-4 text-center text-gray-400">Nenhum serviço encontrado.</td></tr>';
                document.getElementById('admin-services-info').innerText = `Mostrando ${paged.length} de ${list.length}`;
            }
        }

        function initHome() {
            const container = document.getElementById('home-highlights');
            const heroSection = document.querySelector('section.flex.flex-col-reverse'); 
            const quoteSection = document.querySelector('section.bg-primary.rounded-\\[3rem\\]'); 
            
            if(!container) return;

            // --- HELPER DE TEMAS VISUAIS ---
            const getThemeClasses = (theme) => {
                const map = {
                    'default': { card: 'bg-primary', text: 'text-white', iconBg: 'bg-white/10', iconColor: 'text-accent', sub: 'text-slate-400', desc: 'text-slate-300', btn: 'bg-white text-primary hover:bg-accent hover:text-white' },
                    'orange':  { card: 'bg-gradient-to-br from-orange-500 to-amber-600', text: 'text-white', iconBg: 'bg-white/20', iconColor: 'text-white', sub: 'text-orange-100', desc: 'text-orange-50', btn: 'bg-white text-orange-600 hover:bg-gray-100' },
                    'blue':    { card: 'bg-gradient-to-br from-blue-600 to-indigo-700', text: 'text-white', iconBg: 'bg-white/20', iconColor: 'text-blue-200', sub: 'text-blue-200', desc: 'text-blue-100', btn: 'bg-white text-blue-700 hover:bg-blue-50' },
                    'purple':  { card: 'bg-gradient-to-br from-purple-700 to-fuchsia-800', text: 'text-white', iconBg: 'bg-white/20', iconColor: 'text-fuchsia-200', sub: 'text-purple-200', desc: 'text-purple-100', btn: 'bg-white text-purple-800 hover:bg-purple-50' },
                    'green':   { card: 'bg-gradient-to-br from-emerald-600 to-teal-700', text: 'text-white', iconBg: 'bg-white/20', iconColor: 'text-emerald-100', sub: 'text-emerald-100', desc: 'text-emerald-50', btn: 'bg-white text-teal-700 hover:bg-teal-50' },
                };
                return map[theme] || map['default'];
            };

            // 1. RENDERIZAR HERO (Mantido igual)
            const heroBook = DB.books.find(b => b.id === DB.homeConfig.heroBookId) || DB.books[0];
            if(heroSection && heroBook) {
                const titleWords = heroBook.title.split(' ');
                let formattedTitle = heroBook.title;
                if (titleWords.length > 1) {
                    const lastWord = titleWords.pop();
                    const firstPart = titleWords.join(' ');
                    formattedTitle = `${firstPart} <br><span class="text-transparent bg-clip-text bg-gradient-to-r from-accent to-orange-400 font-serif italic pr-2">${lastWord}.</span>`;
                }

                const badgeContainer = heroSection.querySelector('.inline-flex');
                if(DB.homeConfig.showLaunchBadge) {
                    badgeContainer.classList.remove('hidden'); badgeContainer.classList.add('inline-flex');
                } else {
                    badgeContainer.classList.remove('inline-flex'); badgeContainer.classList.add('hidden');
                }

                heroSection.querySelector('h1').innerHTML = formattedTitle;
                const shortDesc = heroBook.coverSynopsis || (heroBook.synopsis.substring(0, 80) + "...");
                heroSection.querySelector('p').innerText = shortDesc;
                heroSection.querySelector('img').src = heroBook.cover;
                heroSection.querySelector('a').innerText = `Ler Agora`;
                heroSection.querySelector('a').href = `#/livro/${heroBook.id}`;
            }

            // 2. RENDERIZAR DESTAQUES (ATUALIZADO COM TEMAS)
            container.innerHTML = DB.homeConfig.highlights.map(id => {
                const book = DB.books.find(b => b.id === id);
                const service = DB.services.find(s => s.id === id);

                if (book) {
                    return `
                    <div class="card-interaction bg-white p-8 rounded-3xl shadow-lg border border-gray-100 flex flex-col md:flex-row gap-8 items-center relative overflow-hidden group">
                        <div class="absolute top-0 right-0 w-40 h-40 bg-accent/5 rounded-full blur-3xl -mr-10 -mt-10"></div>
                        <div class="relative flex-shrink-0 animate-float">
                            <img src="${book.cover}" class="w-32 md:w-36 rounded shadow-xl rotate-3 border-4 border-white group-hover:rotate-0 transition duration-500 cursor-pointer" onclick="window.location.hash='#/livro/${book.id}'">
                        </div>
                        <div class="text-center md:text-left z-10 flex-1">
                            <div class="text-xs font-bold text-accent uppercase tracking-widest mb-2">${book.genre}</div>
                            <h3 class="text-xl md:text-2xl font-bold text-gray-800 mb-2 font-serif leading-tight">${book.title}</h3>
                            <p class="text-sm text-gray-500 mb-5 max-w-xs mx-auto md:mx-0 line-clamp-2">${book.synopsis}</p>
                            <button onclick="window.location.hash='#/livro/${book.id}'" class="bg-primary hover:bg-slate-700 text-white py-2 px-6 rounded-full font-bold text-xs md:text-sm transition shadow-lg w-full md:w-auto">
                                Comprar - R$ ${book.price.toFixed(2)}
                            </button>
                        </div>
                    </div>`;
                } else if (service) {
                    // LÓGICA DE TEMA APLICADA AQUI
                    const style = getThemeClasses(service.theme || 'default');
                    const iconClass = service.icon || 'ph-star-four';

                    return `
                    <div class="card-interaction ${style.card} p-8 rounded-3xl shadow-xl flex flex-col justify-center relative overflow-hidden group min-h-[300px]">
                        <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] opacity-20"></div>
                        <div class="relative z-10">
                            <div class="flex items-center gap-4 mb-4">
                                <div class="${style.iconBg} p-3 rounded-2xl backdrop-blur-md shadow-sm">
                                    <i class="ph-fill ${iconClass} text-2xl ${style.iconColor}"></i>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold leading-none ${style.text}">${service.name}</h3>
                                    <p class="text-[10px] ${style.sub} uppercase tracking-wide mt-1">Serviço Exclusivo</p>
                                </div>
                            </div>
                            <p class="${style.desc} text-sm mb-6 leading-relaxed line-clamp-3">${service.description}</p>
                            <button onclick="window.app.openServiceModal('${service.id}')" class="w-full py-3 px-8 rounded-full font-bold text-sm transition shadow-md ${style.btn}">
                                Solicitar Orçamento
                            </button>
                        </div>
                    </div>`;
                }
                return '';
            }).join('');

            // 3. RENDERIZAR FRASE
            if(quoteSection) {
                quoteSection.querySelector('h3').innerText = `"${DB.homeConfig.quote.text}"`;
                quoteSection.querySelector('p').innerText = `— ${DB.homeConfig.quote.author}`;
            }
        }

        function initCommunity() {
            const feed = document.getElementById('blog-feed');
            const commentsSection = document.getElementById('comments-section');
            const inputArea = document.getElementById('comment-input-area');
            if(!feed) return;
            feed.innerHTML = DB.posts.map(post => `
                <div class="bg-white rounded-2xl border border-gray-100 overflow-hidden shadow-sm hover:shadow-xl transition duration-300 group">
                    <div class="h-48 overflow-hidden relative"><img src="${post.image}" class="w-full h-full object-cover group-hover:scale-105 transition duration-700"><span class="absolute top-4 left-4 bg-white/90 backdrop-blur text-primary text-xs font-bold px-3 py-1 rounded-full uppercase">${post.category}</span></div>
                    <div class="p-8"><div class="flex items-center gap-2 text-xs text-gray-400 mb-3"><i class="ph ph-calendar"></i> ${post.date}</div><h3 class="text-2xl font-bold text-primary mb-3 font-serif group-hover:text-accent transition">${post.title}</h3><p class="text-gray-600 mb-6 leading-relaxed">Lorem ipsum dolor sit amet...</p><div class="flex items-center justify-between border-t border-gray-100 pt-4"><button class="text-accent font-bold text-sm hover:underline">Ler Artigo</button><div class="flex gap-4 text-gray-400 text-sm"><span class="flex items-center gap-1"><i class="ph-fill ph-heart"></i> ${post.likes}</span><span class="flex items-center gap-1"><i class="ph-fill ph-chat-circle"></i> ${post.comments}</span></div></div></div>
                </div>`).join('');
            
            const renderComments = () => {
                commentsSection.innerHTML = DB.comments.map(c => `<div class="flex gap-4 animate-fade-in"><img src="${c.avatar}" class="w-10 h-10 rounded-full border border-gray-200"><div class="bg-gray-50 p-4 rounded-xl rounded-tl-none flex-1"><div class="flex justify-between items-center mb-1"><span class="font-bold text-sm text-primary">${c.user}</span><span class="text-xs text-gray-400">${c.date}</span></div><p class="text-gray-600 text-sm">${c.text}</p></div></div>`).join('');
            };
            renderComments();

            if(user) {
                inputArea.innerHTML = `<div class="flex gap-4 items-start"><img src="${user.avatar}" class="w-10 h-10 rounded-full border-2 border-accent"><div class="flex-1"><textarea id="new-comment" rows="2" placeholder="Participe da discussão..." class="w-full bg-gray-50 border border-gray-200 rounded-xl p-3 text-sm focus:outline-none focus:border-accent transition resize-none"></textarea><button onclick="window.app.postComment()" class="mt-2 bg-accent text-white px-6 py-2 rounded-lg text-xs font-bold hover:bg-accent-hover transition">Enviar</button></div></div>`;
            } else {
                inputArea.innerHTML = `<div class="text-center bg-gray-50 p-6 rounded-xl border border-gray-200 border-dashed"><p class="text-gray-500 text-sm mb-4">Faça login para participar da discussão.</p><button onclick="window.app.connectGoogle()" class="bg-white border border-gray-300 text-gray-700 px-6 py-2 rounded-lg font-bold text-sm shadow-sm hover:bg-gray-50 transition flex items-center justify-center gap-2 mx-auto"><img src="https://www.svgrepo.com/show/475656/google-color.svg" class="w-5 h-5"> Conectar com Google</button></div>`;
            }
        }

        function initLivros() {
                    const grid = document.getElementById('books-grid');
                    const controls = document.getElementById('pagination-controls');
                    if(!grid) return;

                    // FILTRO: Mostrar apenas livros ATIVOS
                    const activeBooks = DB.books.filter(b => b.active === true);

                    // Paginação (Agora baseada nos livros ativos)
                    const start = (currentPage - 1) * itemsPerPage;
                    const booksToShow = activeBooks.slice(start, start + itemsPerPage);
                    const totalPages = Math.ceil(activeBooks.length / itemsPerPage);

                    grid.innerHTML = booksToShow.map(b => {
                        const isFav = favorites.includes(b.id);
                        const heartClass = isFav ? 'ph-fill text-red-500' : 'ph-bold text-gray-400';
                        
                        return `
                        <div class="bg-white p-5 rounded-3xl shadow-lg border border-gray-50 flex flex-col h-full group hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2">
                            <div class="relative mb-5 overflow-hidden rounded-2xl bg-gray-100 aspect-[2/3] shadow-inner">
                                <img src="${b.cover}" class="w-full h-full object-cover transition duration-700 group-hover:scale-110 cursor-pointer" onclick="window.location.hash='#/livro/${b.id}'">
                                <button onclick="window.app.toggleFavorite('${b.id}')" class="absolute top-3 right-3 w-10 h-10 bg-white/90 backdrop-blur rounded-full flex items-center justify-center shadow-md hover:scale-110 transition z-20">
                                    <i class="${heartClass} ph-heart text-xl transition-colors"></i>
                                </button>
                            </div>
                            <div class="text-center">
                                <p class="text-[10px] font-bold text-accent uppercase tracking-wider mb-2">${b.genre}</p>
                                <h3 class="text-xl font-bold text-gray-900 leading-tight font-serif cursor-pointer hover:text-accent transition mb-4" onclick="window.location.hash='#/livro/${b.id}'">${b.title}</h3>
                                <button onclick="window.location.hash='#/livro/${b.id}'" class="w-full bg-gray-50 hover:bg-primary hover:text-white text-primary font-bold text-sm py-3 rounded-xl transition border border-gray-200 hover:border-primary">
                                    Comprar - R$ ${b.isPromotion && b.promoPrice ? b.promoPrice.toFixed(2) : b.price.toFixed(2)}
                                </button>
                            </div>
                        </div>`;
                    }).join('');

                    let paginationHTML = ``;
                    if(totalPages > 1) {
                        paginationHTML += `<button onclick="window.app.changePage(${currentPage - 1})" class="pagination-btn" ${currentPage === 1 ? 'disabled' : ''}><i class="ph ph-caret-left"></i></button>`;
                        for(let i = 1; i <= totalPages; i++) { paginationHTML += `<button onclick="window.app.changePage(${i})" class="pagination-btn ${i === currentPage ? 'active' : ''}">${i}</button>`; }
                        paginationHTML += `<button onclick="window.app.changePage(${currentPage + 1})" class="pagination-btn" ${currentPage === totalPages ? 'disabled' : ''}><i class="ph ph-caret-right"></i></button>`;
                    }
                    controls.innerHTML = paginationHTML;
                }

        function initServicos() { 
                    const grid = document.getElementById('services-grid'); 
                    if(!grid) return; 
                    
                    // Mapa de cores para textos/bordas (versão light para fundo branco)
                    const colorMap = {
                        'default': 'text-primary border-primary',
                        'orange': 'text-orange-500 border-orange-500',
                        'blue': 'text-blue-600 border-blue-600',
                        'purple': 'text-purple-600 border-purple-600',
                        'green': 'text-emerald-600 border-emerald-600'
                    };

                    grid.innerHTML = DB.services.map((s, index) => {
                        const themeClass = colorMap[s.theme || 'default'];
                        const iconClass = s.icon || 'ph-star-four';

                        return `
                        <div class="card-interaction bg-white p-10 rounded-[2rem] shadow-xl border border-gray-100 flex flex-col h-full relative overflow-hidden group">
                            <div class="absolute top-0 left-0 w-full h-2 bg-current ${themeClass.split(' ')[0]} opacity-80"></div>
                            
                            <div class="flex justify-between items-start mb-6">
                                <div class="p-3 bg-gray-50 rounded-2xl text-3xl ${themeClass.split(' ')[0]}">
                                    <i class="ph-fill ${iconClass}"></i>
                                </div>
                                <div class="text-6xl text-gray-100 font-black z-0 group-hover:text-gray-200 transition">0${index+1}</div>
                            </div>

                            <div class="relative z-10 flex-1">
                                <h3 class="text-2xl font-bold text-gray-900 mb-3 font-serif">${s.name}</h3>
                                <div class="text-4xl font-black text-slate-800 mb-6 flex items-baseline gap-2">
                                    R$ ${s.price} <span class="text-xs font-bold text-gray-400 uppercase tracking-wide">${s.unit || ''}</span>
                                </div>
                                <p class="text-gray-600 mb-10 text-base leading-relaxed">${s.description}</p>
                            </div>
                            <button onclick="window.app.openServiceModal('${s.id}')" class="w-full bg-primary text-white py-4 rounded-xl font-bold text-sm transition hover:bg-accent hover:shadow-xl hover:-translate-y-1">
                                Solicitar Orçamento
                            </button>
                        </div>`;
                    }).join(''); 
                }

        function initAbout() {
            // Dados básicos e imagens
            const els = {
                name: document.getElementById('about-name-display'),
                role: document.getElementById('author-role-display'),
                bio: document.getElementById('about-bio-display'),
                imgMain: document.getElementById('about-main-img'),
                imgSec: document.getElementById('about-sec-img'),
                caption: document.getElementById('about-sec-caption')
            };

            if(els.name) els.name.innerHTML = `Olá! Sou o <strong class="text-primary">${DB.author.name}</strong>.`;
            if(els.role) els.role.innerText = DB.author.role;
            if(els.bio) els.bio.innerText = DB.author.bio;
            if(els.imgMain) els.imgMain.src = DB.author.avatar;
            if(els.imgSec) els.imgSec.src = DB.author.secondaryImage;
            if(els.caption) els.caption.innerText = DB.author.secondaryCaption;

            // Renderizar Timeline
            const timelineContainer = document.getElementById('about-timeline-list');
            if(timelineContainer && DB.author.timeline) {
                timelineContainer.innerHTML = DB.author.timeline.map((item, index) => `
                    <div class="relative group">
                        <div class="absolute -left-[41px] top-1 w-5 h-5 bg-gray-300 rounded-full border-4 border-white transition group-hover:bg-accent group-hover:scale-125 shadow-sm"></div>
                        <h4 class="font-bold text-primary text-xl">${item.year}</h4>
                        <p class="font-bold text-gray-700 text-sm mb-1">${item.title}</p>
                        <p class="text-sm text-gray-500 leading-relaxed">${item.desc}</p>
                    </div>
                `).join('');
            }
        }

        // --- FUNÇÕES QUE FAZEM AS TABELAS FUNCIONAREM ---
        function renderBooksTable() {
            // 1. Filtra e Ordena
            let list = DB.books.filter(b => b.title.toLowerCase().includes(adminState.books.filter.toLowerCase()));
            list.sort((a, b) => {
                let vA = a[adminState.books.sortKey], vB = b[adminState.books.sortKey];
                if (typeof vA === 'string') vA = vA.toLowerCase();
                if (typeof vB === 'string') vB = vB.toLowerCase();
                if (vA < vB) return adminState.books.sortOrder === 'asc' ? -1 : 1;
                if (vA > vB) return adminState.books.sortOrder === 'asc' ? 1 : -1;
                return 0;
            });

            // 2. Pagina
            const start = (adminState.books.page - 1) * adminState.itemsPerPage;
            const paged = list.slice(start, start + adminState.itemsPerPage);

            // 3. Injeta no HTML
            const tbody = document.getElementById('admin-books-table');
            if (tbody) {
                tbody.innerHTML = paged.length ? paged.map(b => `
                    <tr class="border-b border-gray-100 hover:bg-gray-50 transition">
                        <td class="p-3"><img src="${b.cover}" class="w-8 h-12 object-cover rounded"></td>
                        <td class="p-3 font-bold text-primary">${b.title}</td>
                        <td class="p-3">R$ ${b.price.toFixed(2)}</td>
                        <td class="p-3 text-center text-xs">${b.isPromotion ? '✅' : '-'}</td>
                        <td class="p-3 text-center"><span class="w-2 h-2 rounded-full inline-block ${b.active ? 'bg-green-500' : 'bg-gray-300'}"></span></td>
                        <td class="p-3 text-right"><button onclick="window.app.openBookModal('${b.id}')" class="text-blue-500 hover:bg-blue-50 p-2 rounded-full"><i class="ph-bold ph-pencil-simple"></i></button><button onclick="window.app.deleteBook('${b.id}')" class="text-red-400 hover:bg-red-50 p-2 rounded-full"><i class="ph-bold ph-trash"></i></button></td>
                    </tr>
                `).join('') : '<tr><td colspan="6" class="p-4 text-center text-gray-400">Nenhum livro encontrado.</td></tr>';
                
                // Atualiza Info da Paginação
                document.getElementById('admin-books-info').innerText = `Mostrando ${paged.length} de ${list.length}`;
            }
        }

        function renderServicesTable() {
            let list = DB.services.filter(s => s.name.toLowerCase().includes(adminState.services.filter.toLowerCase()));
            list.sort((a, b) => {
                let vA = a[adminState.services.sortKey], vB = b[adminState.services.sortKey];
                if (typeof vA === 'string') vA = vA.toLowerCase();
                if (typeof vB === 'string') vB = vB.toLowerCase();
                if (vA < vB) return adminState.services.sortOrder === 'asc' ? -1 : 1;
                if (vA > vB) return adminState.services.sortOrder === 'asc' ? 1 : -1;
                return 0;
            });

            const start = (adminState.services.page - 1) * adminState.itemsPerPage;
            const paged = list.slice(start, start + adminState.itemsPerPage);

            const tbody = document.getElementById('admin-services-table');
            if (tbody) {
                tbody.innerHTML = paged.length ? paged.map(s => `
                    <tr class="border-b border-blue-100 hover:bg-blue-50 transition">
                        <td class="p-3 font-bold text-gray-700 flex items-center gap-2"><i class="ph-fill ${s.icon} text-blue-500"></i> ${s.name}</td>
                        <td class="p-3">R$ ${s.price}</td>
                        <td class="p-3 text-center text-xs">${s.isPromotion ? '✅' : '-'}</td>
                        <td class="p-3 text-center"><span class="w-2 h-2 rounded-full inline-block ${s.active ? 'bg-green-500' : 'bg-gray-300'}"></span></td>
                        <td class="p-3 text-right"><button onclick="window.app.openServiceEditModal('${s.id}')" class="text-blue-500 hover:bg-blue-100 p-2 rounded-full"><i class="ph-bold ph-pencil-simple"></i></button><button onclick="window.app.deleteService('${s.id}')" class="text-red-400 hover:bg-red-100 p-2 rounded-full"><i class="ph-bold ph-trash"></i></button></td>
                    </tr>
                `).join('') : '<tr><td colspan="5" class="p-4 text-center text-gray-400">Nenhum serviço encontrado.</td></tr>';

                document.getElementById('admin-services-info').innerText = `Mostrando ${paged.length} de ${list.length}`;
            }
        }        

        function initHeaderLogic() { const btn = document.getElementById('menu-button'); const menu = document.getElementById('mobile-menu'); if(btn && menu) { btn.onclick = (e) => { e.stopPropagation(); menu.classList.toggle('hidden'); }; document.addEventListener('click', (e) => { if (!menu.contains(e.target) && !btn.contains(e.target)) menu.classList.add('hidden'); }); } const header = document.getElementById('header-container'); window.addEventListener('scroll', () => { if(window.scrollY > 10) { header.classList.add('glass-header'); header.classList.remove('py-4'); header.classList.add('py-2'); } else { header.classList.remove('glass-header'); header.classList.remove('py-2'); header.classList.add('py-4'); } }); }

        // ==========================================
        // 4. API PÚBLICA
        // ===========================1===============
        window.app = {
            toast: (msg, type) => showToast(msg, type),
            _pendingConfirmAction: null,

            cropper: null,
                currentCropCallback: null,

            handleImageUpload: (input, targetImgId, targetInputId, aspectRatio = 1) => {
                    const file = input.files[0];
                    if (!file) return;

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const modal = document.getElementById('cropper-modal');
                        const image = document.getElementById('cropper-image');
                        
                        image.src = e.target.result;
                        modal.classList.remove('hidden');

                        if (window.app.cropper) { window.app.cropper.destroy(); }

                        window.app.cropper = new Cropper(image, {
                            aspectRatio: aspectRatio,
                            viewMode: 1,
                            dragMode: 'move',
                            autoCropArea: 1,
                        });

                        // Define o que acontece ao confirmar
                        window.app.currentCropCallback = (base64) => {
                            // Atualiza o preview visual
                            const imgPreview = document.getElementById(targetImgId);
                            if(imgPreview) imgPreview.src = base64;
                            
                            // Atualiza o input hidden que será salvo
                            const inputHidden = document.getElementById(targetInputId);
                            if(inputHidden) inputHidden.value = base64;
                            
                            // Reseta o input file para permitir selecionar a mesma foto se quiser
                            input.value = '';
                        };
                    };
                    reader.readAsDataURL(file);
            },

            confirmCrop: () => {
                    if (!window.app.cropper) return;
                    // Gera o Base64 (qualidade 0.8 para não pesar tanto o LocalStorage)
                    const canvas = window.app.cropper.getCroppedCanvas({ maxWidth: 800, maxHeight: 800 });
                    const base64 = canvas.toDataURL('image/jpeg', 0.8);
                    
                    if (window.app.currentCropCallback) window.app.currentCropCallback(base64);
                    window.app.cancelCrop();
            },

            cancelCrop: () => {
                    document.getElementById('cropper-modal').classList.add('hidden');
                    if (window.app.cropper) {
                        window.app.cropper.destroy();
                        window.app.cropper = null;
                    }
                    window.app.currentCropCallback = null;
            },

            setAdminTab: (tab) => {
                adminState.currentTab = tab;
                initDashboard(); // Re-renderiza o painel
            },

            

            // --- CRM: LEADS ---
            submitBudgetRequest: () => {
                // Pega dados do modal de serviço aberto
                const name = document.querySelector('#modal-content input[placeholder="Nome Completo"]').value;
                const email = document.querySelector('#modal-content input[placeholder="E-mail Profissional"]').value;
                const desc = document.querySelector('#modal-content textarea').value;
                const serviceName = document.querySelector('#modal-content h4').innerText;

                if(!name || !email) return window.app.toast('Preencha nome e e-mail!', 'error');

                DB.leads.unshift({
                    id: Date.now(),
                    name, email, desc,
                    service: serviceName,
                    date: new Date().toLocaleDateString('pt-BR'),
                    status: 'pending'
                });

                window.app.toast('Solicitação enviada com sucesso!', 'success');
                window.app.closeModal();
            },

            archiveLead: (id) => {
                const lead = DB.leads.find(l => l.id === id);
                if(lead) {
                    lead.status = 'archived';
                    initDashboard(); // Atualiza a lista
                    window.app.toast('Solicitação arquivada.', 'success');
                }
            },

            // --- ANALYTICS ---
            trackClick: (type) => {
                // Simulação de tracking
                if(type === 'amazon') DB.stats.clicksAmazon++;
                if(type === 'ml') DB.stats.clicksML++;
                if(type === 'shopee') DB.stats.clicksShopee++;
                // Em um app real, aqui enviaria para o backend
            },


            // ==========================================
            // NAVEGAÇÃO & GERAL
            // ==========================================
            changePage: (n) => { currentPage = n; initLivros(); document.getElementById('books-grid').scrollIntoView({ behavior: 'smooth', block: 'start' }); },
            setAdminFilter: (context, key, value) => { adminState[context][key] = value; adminState[context].page = 1; initDashboard(); },
            changeAdminPage: (context, direction) => { adminState[context].page += direction; initDashboard(); },
            sortData: (context, key) => {
                if(adminState[context].sortKey === key) { adminState[context].sortOrder = adminState[context].sortOrder === 'asc' ? 'desc' : 'asc'; } 
                else { adminState[context].sortKey = key; adminState[context].sortOrder = 'asc'; }
                initDashboard();
            },
            toggleFavorite: (id) => {
                if (favorites.includes(id)) { favorites = favorites.filter(favId => favId !== id); window.app.toast('Removido dos favoritos', 'success'); } 
                else { favorites.push(id); window.app.toast('Adicionado aos favoritos!', 'success'); }
                localStorage.setItem('user_favorites', JSON.stringify(favorites));
                if (window.location.hash.includes('livros')) initLivros();
                if (window.location.hash.includes('livro/')) initBookDetails(id);
            },

            // ==========================================
            // CMS: HOME & PERSONALIZAÇÃO
            // ==========================================
            
            // --- Helpers Dropdown Home ---
            toggleDropdown: (id) => { const el = document.getElementById(id); if(el) el.classList.toggle('hidden'); },
            selectHeroBook: (bookId, bookTitle) => { document.getElementById('config-hero-input').value = bookId; document.getElementById('config-hero-btn-text').innerText = bookTitle; document.getElementById('custom-dropdown-list').classList.add('hidden'); },

            // --- Modal Config Home ---
            openHomeConfigModal: () => {
                const currentHeroBook = DB.books.find(b => b.id === DB.homeConfig.heroBookId) || DB.books[0];
                const dropdownItems = DB.books.map(b => `<div onclick="window.app.selectHeroBook('${b.id}', '${b.title}')" class="p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-50 flex items-center gap-3 transition"><img src="${b.cover}" class="w-8 h-10 object-cover rounded shadow-sm"><span class="text-sm font-bold text-gray-700">${b.title}</span></div>`).join('');
                const isChecked = (id) => DB.homeConfig.highlights.includes(id) ? 'checked' : '';
                const highlightsList = [...DB.books.map(b => ({id: b.id, type: 'Livro', name: b.title})), ...DB.services.map(s => ({id: s.id, type: 'Serviço', name: s.name}))].map(item => `<label class="flex items-center gap-3 p-3 border border-gray-100 rounded-lg hover:bg-gray-50 cursor-pointer transition"><input type="checkbox" name="home-highlights" value="${item.id}" ${isChecked(item.id)} class="w-5 h-5 text-accent rounded focus:ring-accent"><div><span class="text-xs font-bold uppercase text-gray-400 block">${item.type}</span><span class="text-sm font-bold text-gray-700">${item.name}</span></div></label>`).join('');
                
                const body = `<div class="space-y-8 animate-fade-in custom-scrollbar max-h-[60vh] overflow-y-auto pr-2 pb-10"><div class="bg-gray-50 p-6 rounded-2xl border border-gray-200"><div class="flex items-center gap-3 mb-2"><div class="w-8 h-8 rounded-full bg-primary text-white flex items-center justify-center font-bold text-xs">1</div><h4 class="font-bold text-primary">Destaque Principal (Hero)</h4></div><p class="text-xs text-gray-500 mb-6 ml-11">Este livro aparecerá com destaque máximo no topo.</p><div class="relative ml-11 mb-6"><input type="hidden" id="config-hero-input" value="${currentHeroBook.id}"><button onclick="window.app.toggleDropdown('custom-dropdown-list')" class="w-full bg-white border border-gray-300 rounded-xl p-4 flex items-center justify-between shadow-sm hover:border-accent transition group"><span id="config-hero-btn-text" class="font-bold text-gray-700">${currentHeroBook.title}</span><i class="ph-bold ph-caret-down text-gray-400 group-hover:text-accent"></i></button><div id="custom-dropdown-list" class="hidden absolute top-full left-0 w-full bg-white border border-gray-200 rounded-xl shadow-xl mt-2 z-50 max-h-48 overflow-y-auto custom-scrollbar">${dropdownItems}</div></div><div class="ml-11 flex items-center justify-between bg-white p-4 rounded-xl border border-gray-200"><div><span class="font-bold text-gray-800 text-sm block">Selo "Último Lançamento"</span><span class="text-xs text-gray-400">Exibir badge pulsante acima do título?</span></div><label class="relative inline-flex items-center cursor-pointer"><input type="checkbox" id="config-launch-badge" class="sr-only peer" ${DB.homeConfig.showLaunchBadge ? 'checked' : ''}><div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-500"></div></label></div></div><div class="bg-white p-6 rounded-2xl border border-gray-200 shadow-sm"><div class="flex items-center gap-3 mb-4"><div class="w-8 h-8 rounded-full bg-accent text-white flex items-center justify-center font-bold text-xs">2</div><h4 class="font-bold text-primary">Em Destaque (Highlights)</h4></div><div class="grid grid-cols-1 md:grid-cols-2 gap-3 ml-11">${highlightsList}</div></div><div class="bg-blue-50 p-6 rounded-2xl border border-blue-100"><div class="flex items-center gap-3 mb-4"><div class="w-8 h-8 rounded-full bg-blue-500 text-white flex items-center justify-center font-bold text-xs">3</div><h4 class="font-bold text-primary">Frase de Efeito</h4></div><div class="space-y-3 ml-11"><textarea id="config-quote-text" rows="2" class="w-full bg-white border border-blue-200 rounded-lg p-3 text-sm font-serif italic text-gray-700">${DB.homeConfig.quote.text}</textarea><input type="text" id="config-quote-author" value="${DB.homeConfig.quote.author}" class="w-full bg-white border border-blue-200 rounded-lg p-2 text-sm font-bold text-gray-700"></div></div></div>`;
                const footer = `<button onclick="window.app.closeModal()" class="px-4 py-2 text-gray-500 font-bold text-sm">Cancelar</button><button onclick="window.app.saveHomeConfig()" class="bg-primary text-white px-6 py-2 rounded-lg font-bold shadow-lg">Salvar</button>`;
                window.app.openModalGeneric("Personalizar Home", body, footer);
            },
            saveHomeConfig: () => {
                const heroId = document.getElementById('config-hero-input').value;
                const showLaunch = document.getElementById('config-launch-badge').checked;
                const quoteText = document.getElementById('config-quote-text').value;
                const quoteAuthor = document.getElementById('config-quote-author').value;
                const checkboxes = document.querySelectorAll('input[name="home-highlights"]:checked');
                const selectedHighlights = Array.from(checkboxes).map(cb => cb.value);
                if (selectedHighlights.length === 0) return window.app.toast('Selecione pelo menos 1 destaque.', 'error');
                if (selectedHighlights.length > 4) return window.app.toast('Máximo de 4 destaques.', 'error');
                DB.homeConfig = { heroBookId: heroId, showLaunchBadge: showLaunch, highlights: selectedHighlights, quote: { text: quoteText, author: quoteAuthor } };
                window.app.toast('Home atualizada!', 'success'); window.app.closeModal();
            },

            // ==========================================
            // CMS: SOBRE (NOVA IMPLEMENTAÇÃO)
            // ==========================================
            openAboutConfigModal: () => {
                const renderTimelineInputs = () => {
                    return (DB.author.timeline || []).map((t, idx) => `
                        <div class="flex gap-3 items-start bg-gray-50 p-3 rounded-lg border border-gray-200 group hover:border-accent transition">
                            <div class="w-20 pt-2">
                                <label class="text-[10px] font-bold text-gray-400 uppercase">Ano</label>
                                <input type="text" value="${t.year}" class="w-full bg-white border border-gray-200 rounded p-1 text-sm font-bold text-center">
                            </div>
                            <div class="flex-1">
                                <label class="text-[10px] font-bold text-gray-400 uppercase">Evento</label>
                                <input type="text" value="${t.title}" class="w-full bg-white border border-gray-200 rounded p-1 text-sm font-bold mb-1">
                                <textarea rows="2" class="w-full bg-white border border-gray-200 rounded p-1 text-xs text-gray-600 resize-none">${t.desc}</textarea>
                            </div>
                            <button onclick="this.parentElement.remove()" class="text-red-400 hover:text-red-600 p-2 hover:bg-red-50 rounded mt-4"><i class="ph-bold ph-trash"></i></button>
                        </div>
                    `).join('');
                };

                const body = `
                    <div class="space-y-6 max-h-[60vh] overflow-y-auto pr-2 custom-scrollbar">
                        <div class="bg-white p-5 rounded-xl border border-gray-100 shadow-sm">
                            <h4 class="font-bold text-primary mb-4 flex items-center gap-2"><i class="ph-fill ph-identification-card text-accent"></i> Perfil do Autor</h4>
                            
                            <div class="mb-6 flex gap-4 items-center bg-gray-50 p-3 rounded-lg border border-gray-200">
                                <img id="preview-author-main" src="${DB.author.avatar}" class="w-16 h-16 rounded-full object-cover border-2 border-white shadow">
                                <div class="flex-1">
                                    <label class="text-xs font-bold text-gray-500 uppercase block mb-1">Foto Principal</label>
                                    <input type="file" accept="image/*" onchange="window.app.handleImageUpload(this, 'preview-author-main', 'cfg-author-avatar', 1)" class="text-xs w-full text-gray-500 file:mr-2 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-bold file:bg-primary file:text-white hover:file:bg-slate-700">
                                    <input type="hidden" id="cfg-author-avatar" value="${DB.author.avatar}">
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div><label class="text-xs font-bold text-gray-500 uppercase">Nome de Exibição</label><input type="text" id="cfg-author-name" value="${DB.author.name}" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-2 form-input font-bold"></div>
                                <div><label class="text-xs font-bold text-gray-500 uppercase">Cargo / Tagline</label><input type="text" id="cfg-author-role" value="${DB.author.role}" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-2 form-input"></div>
                            </div>
                            <div class="mb-4"><label class="text-xs font-bold text-gray-500 uppercase">Biografia Principal</label><textarea id="cfg-author-bio" rows="4" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-3 form-input text-sm leading-relaxed">${DB.author.bio}</textarea></div>
                        </div>
                        
                        <div class="bg-orange-50 p-5 rounded-xl border border-orange-100">
                            <h4 class="font-bold text-orange-800 mb-4 flex items-center gap-2"><i class="ph-fill ph-image text-orange-600"></i> Foto "Polaroid" (Secundária)</h4>
                            
                            <div class="mb-4 flex gap-4 items-center bg-white p-3 rounded-lg border border-orange-200">
                                <img id="preview-author-sec" src="${DB.author.secondaryImage}" class="w-16 h-16 rounded object-cover border border-gray-200 shadow">
                                <div class="flex-1">
                                    <label class="text-xs font-bold text-orange-700 uppercase block mb-1">Imagem Polaroid</label>
                                    <input type="file" accept="image/*" onchange="window.app.handleImageUpload(this, 'preview-author-sec', 'cfg-sec-img', 4/3)" class="text-xs w-full text-gray-500 file:mr-2 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-bold file:bg-orange-600 file:text-white hover:file:bg-orange-700">
                                    <input type="hidden" id="cfg-sec-img" value="${DB.author.secondaryImage}">
                                </div>
                            </div>

                            <div><label class="text-xs font-bold text-orange-700 uppercase">Legenda (Manuscrita)</label><input type="text" id="cfg-sec-caption" value="${DB.author.secondaryCaption}" class="w-full bg-white border border-orange-200 rounded-lg p-2 form-input font-hand text-xl text-gray-600"></div>
                        </div>
                        <div class="bg-gray-50 p-5 rounded-xl border border-gray-200">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="font-bold text-primary flex items-center gap-2"><i class="ph-fill ph-path text-accent"></i> Linha do Tempo</h4>
                                <button onclick="window.app.addTimelineItem()" class="text-xs bg-primary text-white px-3 py-1 rounded hover:bg-slate-700 transition font-bold">+ Adicionar Evento</button>
                            </div>
                            <div id="config-timeline-list" class="space-y-3">${renderTimelineInputs()}</div>
                        </div>
                    </div>
                `;

                const footer = `<button onclick="window.app.closeModal()" class="px-4 py-2 text-gray-500 font-bold text-sm">Cancelar</button><button onclick="window.app.saveAboutConfig()" class="bg-primary text-white px-6 py-2 rounded-lg font-bold shadow-lg flex items-center gap-2"><i class="ph-bold ph-floppy-disk"></i> Salvar</button>`;
                window.app.openModalGeneric("Editor de Narrativa", body, footer);
            },

            saveAboutConfig: () => {
                DB.author.name = document.getElementById('cfg-author-name').value;
                DB.author.role = document.getElementById('cfg-author-role').value;
                DB.author.bio = document.getElementById('cfg-author-bio').value;
                DB.author.avatar = document.getElementById('cfg-author-avatar').value;
                DB.author.secondaryImage = document.getElementById('cfg-sec-img').value;
                DB.author.secondaryCaption = document.getElementById('cfg-sec-caption').value;
            
                const newTimeline = [];
                const container = document.getElementById('config-timeline-list');
                if(container) {
                    for(let block of container.children) {
                        const inputs = block.querySelectorAll('input, textarea');
                        if(inputs.length >= 3) {
                            newTimeline.push({ year: inputs[0].value, title: inputs[1].value, desc: inputs[2].value });
                        }
                    }
                }
                newTimeline.sort((a, b) => parseInt(a.year) - parseInt(b.year));
                DB.author.timeline = newTimeline;
            
                window.app.toast('Biografia atualizada!', 'success');
                initAbout(); // Atualiza a tela se estiver nela
                window.app.closeModal();
            },
            
            addTimelineItem: () => {
                const container = document.getElementById('config-timeline-list');
                const div = document.createElement('div');
                div.className = "flex gap-3 items-start bg-white p-3 rounded-lg border-2 border-accent/20 animate-fade-in";
                div.innerHTML = `<div class="w-20 pt-2"><label class="text-[10px] font-bold text-accent uppercase">Ano</label><input type="text" value="${new Date().getFullYear()}" class="w-full bg-gray-50 border border-gray-200 rounded p-1 text-sm font-bold text-center text-accent"></div><div class="flex-1"><label class="text-[10px] font-bold text-accent uppercase">Novo Evento</label><input type="text" placeholder="Título..." class="w-full bg-gray-50 border border-gray-200 rounded p-1 text-sm font-bold mb-1 focus:border-accent outline-none"><textarea rows="2" placeholder="Descrição..." class="w-full bg-gray-50 border border-gray-200 rounded p-1 text-xs text-gray-600 resize-none focus:border-accent outline-none"></textarea></div><button onclick="this.parentElement.remove()" class="text-red-400 hover:text-red-600 p-2 hover:bg-red-50 rounded mt-4"><i class="ph-bold ph-trash"></i></button>`;
                container.appendChild(div);
                div.scrollIntoView({ behavior: 'smooth' });
            },

            // ==========================================
            // HELPERS: UI DE SERVIÇOS (ÍCONE E COR)
            // ==========================================
            filterIconGrid: (term) => {
                const items = document.querySelectorAll('.icon-grid-item');
                items.forEach(item => {
                    const iconName = item.dataset.icon;
                    if(iconName.includes(term.toLowerCase())) { item.classList.remove('hidden'); } else { item.classList.add('hidden'); }
                });
            },
            selectServiceIcon: (iconName) => {
                document.getElementById('service-icon-input').value = iconName;
                document.getElementById('icon-preview-display').className = `ph-fill ${iconName} text-2xl text-primary`;
                document.getElementById('icon-picker-modal').classList.add('hidden');
            },
            selectServiceTheme: (themeName) => {
                document.getElementById('service-theme-input').value = themeName;
                document.querySelectorAll('.theme-dot').forEach(el => {
                    if(el.dataset.theme === themeName) { el.classList.add('ring-2', 'ring-offset-2', 'ring-gray-400', 'scale-110'); } 
                    else { el.classList.remove('ring-2', 'ring-offset-2', 'ring-gray-400', 'scale-110'); }
                });
            },
            toggleIconPicker: () => {
                const picker = document.getElementById('icon-picker-modal');
                picker.classList.toggle('hidden');
                if(!picker.classList.contains('hidden')) { document.getElementById('icon-search-input').focus(); }
            },

            // ==========================================
            // SISTEMA DE CONFIRMAÇÃO & MODAL GENÉRICO
            // ==========================================
            openConfirmModal: (title, message, iconType, confirmText, callback) => {
                window.app._pendingConfirmAction = callback;
                const isDanger = iconType === 'danger';
                const colorClass = isDanger ? 'text-red-500 bg-red-50 border-red-100' : 'text-amber-500 bg-amber-50 border-amber-100';
                const iconName = isDanger ? 'ph-trash' : 'ph-warning';
                const btnClass = isDanger ? 'bg-red-500 hover:bg-red-600' : 'bg-primary hover:bg-slate-800';
                const body = `<div class="flex flex-col items-center text-center animate-fade-in"><div class="w-20 h-20 rounded-full flex items-center justify-center mb-6 ${colorClass} border-4 shadow-sm"><i class="ph-fill ${iconName} text-4xl"></i></div><h4 class="text-2xl font-bold text-gray-800 mb-2 font-serif">${title}</h4><p class="text-gray-500 text-sm leading-relaxed max-w-xs mx-auto">${message}</p></div>`;
                const footer = `<div class="flex gap-3 w-full justify-center"><button onclick="window.app.closeModal()" class="flex-1 py-3 px-4 rounded-xl border border-gray-200 text-gray-600 font-bold text-sm hover:bg-gray-50 transition">Cancelar</button><button onclick="window.app.executeConfirm()" class="flex-1 py-3 px-4 rounded-xl text-white font-bold text-sm shadow-lg transition transform hover:-translate-y-0.5 ${btnClass}">${confirmText}</button></div>`;
                window.app.openModalGeneric(" ", body, footer);
            },
            executeConfirm: () => { if (window.app._pendingConfirmAction) { window.app._pendingConfirmAction(); window.app._pendingConfirmAction = null; } window.app.closeModal(); },
            openModalGeneric: (title, bodyHTML, footerHTML) => { document.getElementById('modal-title').innerText = title; document.getElementById('modal-body').innerHTML = bodyHTML; document.getElementById('modal-footer').innerHTML = footerHTML; const modal = document.getElementById('modal-overlay'); const content = document.getElementById('modal-content'); modal.classList.remove('hidden'); setTimeout(() => { modal.classList.remove('opacity-0'); content.classList.remove('opacity-0', 'scale-95'); }, 10); },
            closeModal: () => { const modal = document.getElementById('modal-overlay'); const content = document.getElementById('modal-content'); modal.classList.add('opacity-0'); content.classList.add('opacity-0', 'scale-95'); setTimeout(() => modal.classList.add('hidden'), 300); },

            // ==========================================
            // CRUD: LIVROS
            // ==========================================
            deleteBook: (id) => { window.app.openConfirmModal('Excluir Livro?', 'Você tem certeza? Essa ação removerá a obra da sua biblioteca permanentemente.', 'danger', 'Sim, Excluir', () => { DB.books = DB.books.filter(b => b.id !== id); if(DB.books.length % adminState.itemsPerPage === 0 && adminState.books.page > 1) { adminState.books.page--; } initDashboard(); window.app.toast('Livro excluído com sucesso.', 'success'); }); },
            
            openBookModal: (id = null) => {
                const book = id ? DB.books.find(b => b.id === id) : { id: '', title: '', genre: 'Ficção', price: '', promoPrice: '', cover: 'https://placehold.co/300x450/333/FFF?text=Sem+Capa', synopsis: '', coverSynopsis: '', isPromotion: false, active: true, linkAmazon: '', linkML: '', linkShopee: '' };
                const isEdit = !!id;
                const toggleScript = `if(this.checked){document.getElementById('promo-input-container').classList.remove('hidden');document.getElementById('book-promo-price').focus();}else{document.getElementById('promo-input-container').classList.add('hidden');document.getElementById('book-promo-price').value='';}`;
                
                const body = `
                <div class="space-y-4 h-[60vh] overflow-y-auto pr-2 custom-scrollbar">
                    <input type="hidden" id="book-id" value="${book.id || ''}">
                    
                    <div class="flex gap-4 items-start bg-gray-50 p-4 rounded-xl border border-gray-200">
                        <div class="w-24 h-36 bg-gray-200 rounded shadow-sm overflow-hidden flex-shrink-0">
                            <img id="preview-book-cover" src="${book.cover}" class="w-full h-full object-cover">
                        </div>
                        <div class="flex-1">
                            <label class="text-xs font-bold text-primary uppercase block mb-2">Capa do Livro</label>
                            <p class="text-xs text-gray-400 mb-3">Recomendado: Proporção 2:3 (Ex: 600x900px)</p>
                            <input type="file" accept="image/*" onchange="window.app.handleImageUpload(this, 'preview-book-cover', 'book-cover', 2/3)" class="text-xs w-full text-gray-500 file:mr-2 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-xs file:font-bold file:bg-white file:border-gray-200 file:text-primary file:shadow-sm hover:file:bg-gray-50 cursor-pointer">
                            <input type="hidden" id="book-cover" value="${book.cover}">
                        </div>
                    </div>

                    <div class="flex items-center justify-between bg-gray-50 p-3 rounded-lg border border-gray-200">
                        <div><label class="text-xs font-bold text-gray-500 uppercase block">Visibilidade</label><span class="text-sm font-bold text-primary">O livro está visível no site?</span></div>
                        <label class="relative inline-flex items-center cursor-pointer"><input type="checkbox" id="book-active" class="sr-only peer" ${book.active ? 'checked' : ''}><div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-500"></div></label>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div class="col-span-2"><label class="text-xs font-bold text-gray-500 uppercase">Título da Obra</label><input type="text" id="book-title" value="${book.title}" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-2 form-input font-bold text-gray-700"></div>
                        <div><label class="text-xs font-bold text-gray-500 uppercase">Gênero</label><select id="book-genre" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-2 form-input"><option value="Ficção" ${book.genre === 'Ficção' ? 'selected' : ''}>Ficção</option><option value="Fantasia" ${book.genre === 'Fantasia' ? 'selected' : ''}>Fantasia</option><option value="Terror" ${book.genre === 'Terror' ? 'selected' : ''}>Terror</option><option value="Romance" ${book.genre === 'Romance' ? 'selected' : ''}>Romance</option></select></div>
                        <div><label class="text-xs font-bold text-gray-500 uppercase">Preço Original (R$)</label><input type="number" step="0.01" id="book-price" value="${book.price}" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-2 form-input"></div>
                    </div>
                    
                    <div class="bg-gray-50 p-3 rounded-lg border border-gray-200">
                        <label class="text-xs font-bold text-primary uppercase flex justify-between">Resumo da Capa (Home)<span class="text-gray-400 font-normal text-[10px]">Máx 65 caracteres</span></label>
                        <input type="text" id="book-cover-synopsis" value="${book.coverSynopsis || ''}" maxlength="65" placeholder="Frase de impacto para a Home..." class="w-full bg-white border border-gray-300 rounded-lg p-2 mt-1 form-input text-sm">
                    </div>
                    
                    <div class="bg-orange-50 p-4 rounded-xl border border-orange-100 transition-all">
                        <div class="flex items-center justify-between mb-2">
                            <div><h4 class="font-bold text-orange-800 text-sm">Modo Promoção</h4><p class="text-xs text-orange-600">Ativa oferta especial na página.</p></div>
                            <label class="relative inline-flex items-center cursor-pointer"><input type="checkbox" id="book-promo" class="sr-only peer" onchange="${toggleScript}" ${book.isPromotion ? 'checked' : ''}><div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-accent"></div></label>
                        </div>
                        <div id="promo-input-container" class="${book.isPromotion ? '' : 'hidden'} animate-fade-in mt-3 border-t border-orange-200 pt-3">
                            <label class="text-xs font-bold text-orange-700 uppercase">Preço Promocional (R$)</label>
                            <input type="number" step="0.01" id="book-promo-price" value="${book.promoPrice || ''}" placeholder="Ex: 19.90" class="w-full bg-white border border-orange-200 rounded-lg p-2 form-input text-orange-900 font-bold">
                        </div>
                    </div>
                    
                    <div><label class="text-xs font-bold text-gray-500 uppercase">Sinopse Completa</label><textarea id="book-synopsis" rows="4" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-3 form-input text-sm leading-relaxed">${book.synopsis || ''}</textarea></div>
                    
                    <div class="border-t border-gray-100 pt-4">
                        <h4 class="font-bold text-gray-700 mb-3 text-sm">Links de Venda</h4>
                        <div class="grid grid-cols-1 gap-2">
                            <input type="text" id="link-amazon" value="${book.linkAmazon}" placeholder="Link Amazon" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-2 text-xs">
                            <input type="text" id="link-ml" value="${book.linkML}" placeholder="Link Mercado Livre" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-2 text-xs">
                            <input type="text" id="link-shopee" value="${book.linkShopee}" placeholder="Link Shopee" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-2 text-xs">
                        </div>
                    </div>
                </div>`;
                
                const footer = `<button onclick="window.app.closeModal()" class="px-4 py-2 text-gray-500 font-bold text-sm hover:text-gray-800 transition">Cancelar</button><button onclick="window.app.saveBook(${isEdit})" class="bg-primary hover:bg-slate-800 text-white px-6 py-2 rounded-lg font-bold shadow-lg transition flex items-center gap-2"><i class="ph-bold ph-floppy-disk"></i> Salvar</button>`;
                window.app.openModalGeneric(isEdit ? "Editar Livro" : "Cadastrar Novo Livro", body, footer);
            },

            saveBook: (isEdit) => {
                const id = document.getElementById('book-id').value; const title = document.getElementById('book-title').value; const genre = document.getElementById('book-genre').value; const price = parseFloat(document.getElementById('book-price').value); const cover = document.getElementById('book-cover').value || 'https://placehold.co/300x450/333/FFF?text=Capa'; const synopsis = document.getElementById('book-synopsis').value; const coverSynopsis = document.getElementById('book-cover-synopsis').value;
                const active = document.getElementById('book-active').checked; const isPromotion = document.getElementById('book-promo').checked; const linkAmazon = document.getElementById('link-amazon').value; const linkML = document.getElementById('link-ml').value; const linkShopee = document.getElementById('link-shopee').value; let promoPrice = null;
                if(!title || isNaN(price) || price <= 0) return window.app.toast('Dados inválidos', 'error');
                if (isPromotion) { promoPrice = parseFloat(document.getElementById('book-promo-price').value); if (isNaN(promoPrice) || promoPrice <= 0) return window.app.toast('Preço promocional inválido', 'error'); if (promoPrice >= price) return window.app.toast('Preço maior que o original', 'error'); }
                const bookData = { id: isEdit ? id : Date.now().toString(), title, genre, price, cover, synopsis, coverSynopsis, active, isPromotion, promoPrice, linkAmazon, linkML, linkShopee };
                if(isEdit) { const index = DB.books.findIndex(b => b.id === id); if (index !== -1) { DB.books[index] = bookData; window.app.toast('Livro atualizado!', 'success'); } } else { DB.books.unshift(bookData); window.app.toast('Novo livro cadastrado!', 'success'); }
                initDashboard(); window.app.closeModal();
            },

            setAdminTab: (tab) => {
                    adminState.currentTab = tab;
                    initDashboard();
                },
                archiveLead: (id) => {
                    const lead = DB.leads.find(l => l.id === id);
                    if(lead) { lead.status = 'archived'; initDashboard(); window.app.toast('Solicitação arquivada.', 'success'); }
                },
                // Rastreio de cliques nos botões de compra
                trackClick: (type) => {
                    if(type === 'amazon') DB.stats.clicksAmazon++;
                    if(type === 'ml') DB.stats.clicksML++;
                    if(type === 'shopee') DB.stats.clicksShopee++;
                },
                // Salvar novo pedido de orçamento (Modal Serviços)
                submitBudgetRequest: () => {
                    const name = document.querySelector('#modal-content input[placeholder="Nome Completo"]').value;
                    const email = document.querySelector('#modal-content input[placeholder="E-mail Profissional"]').value;
                    const desc = document.querySelector('#modal-content textarea').value;
                    const serviceName = document.querySelector('#modal-content h4').innerText;
                    if(!name || !email) return window.app.toast('Preencha nome e e-mail!', 'error');
                    DB.leads.unshift({ id: Date.now(), name, email, desc, service: serviceName, date: new Date().toLocaleDateString('pt-BR'), status: 'pending' });
                    window.app.toast('Solicitação enviada!', 'success'); window.app.closeModal();
                },

            // ==========================================
            // CRUD: SERVIÇOS
            // ==========================================
            deleteService: (id) => { window.app.openConfirmModal('Remover Serviço?', 'Este serviço não estará mais visível para contratação. Deseja continuar?', 'danger', 'Remover', () => { DB.services = DB.services.filter(s => s.id !== id); if(DB.services.length % adminState.itemsPerPage === 0 && adminState.services.page > 1) { adminState.services.page--; } initDashboard(); window.app.toast('Serviço removido.', 'success'); }); },
            openServiceEditModal: (id = null) => {
                let randomTheme = 'default'; let randomIcon = 'ph-star-four';
                if (!id) { const themes = Object.keys(THEMES); const icons = ICON_LIBRARY; randomTheme = themes[Math.floor(Math.random() * themes.length)]; randomIcon = icons[Math.floor(Math.random() * icons.length)]; }
                const s = id ? DB.services.find(x => x.id === id) : { id: '', name: '', price: '', unit: '', description: '', active: true, isPromotion: false, promoPrice: '', icon: randomIcon, theme: randomTheme };
                const isEdit = !!id;
                const promoToggle = `if(this.checked){document.getElementById('serv-promo-container').classList.remove('hidden');}else{document.getElementById('serv-promo-container').classList.add('hidden');document.getElementById('serv-promo-price').value='';}`;
                const iconGridHTML = ICON_LIBRARY.map(ic => `<div onclick="window.app.selectServiceIcon('${ic}')" class="icon-grid-item p-3 rounded-lg hover:bg-gray-100 cursor-pointer flex items-center justify-center transition" data-icon="${ic}" title="${ic}"><i class="ph-fill ${ic} text-2xl text-gray-600 hover:text-primary"></i></div>`).join('');
                const colorDotsHTML = Object.entries(THEMES).map(([key, val]) => `<div onclick="window.app.selectServiceTheme('${key}')" data-theme="${key}" class="theme-dot w-8 h-8 rounded-full cursor-pointer transition-all hover:scale-110 ${val.dot} ${s.theme === key ? 'ring-2 ring-offset-2 ring-gray-400 scale-110' : ''}" title="${val.name}"></div>`).join('');
                const body = `<div class="space-y-5 h-[60vh] overflow-y-auto pr-2 custom-scrollbar"><input type="hidden" id="service-id" value="${s.id || ''}"><div class="flex items-center justify-between bg-gray-50 p-3 rounded-lg border border-gray-200"><span class="text-xs font-bold text-gray-500 uppercase">Status do Serviço</span><label class="relative inline-flex items-center cursor-pointer"><input type="checkbox" id="service-active" class="sr-only peer" ${s.active ? 'checked' : ''}><div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-500"></div></label></div><div class="space-y-4"><div><label class="text-xs font-bold text-gray-500 uppercase">Nome do Serviço</label><input type="text" id="service-name" value="${s.name}" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-2 form-input font-bold text-gray-700"></div><div class="grid grid-cols-2 gap-4"><div><label class="text-xs font-bold text-gray-500 uppercase">Preço Base (R$)</label><input type="number" step="0.01" id="service-price" value="${s.price}" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-2 form-input"></div><div><label class="text-xs font-bold text-gray-500 uppercase">Unidade</label><input type="text" id="service-unit" value="${s.unit || ''}" placeholder="Ex: p/ hora" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-2 form-input"></div></div></div><div class="bg-gray-50 p-5 rounded-xl border border-gray-200"><div class="mb-4 border-b border-gray-200 pb-2"><span class="font-bold text-gray-800 text-sm flex items-center gap-2"><i class="ph-fill ph-paint-brush text-accent"></i> Identidade Visual</span></div><div class="space-y-5"><div><label class="text-xs font-bold text-gray-500 uppercase mb-2 block">Ícone Principal</label><input type="hidden" id="service-icon-input" value="${s.icon}"><button onclick="window.app.toggleIconPicker()" class="w-full bg-white border border-gray-300 rounded-lg p-3 flex items-center justify-between hover:bg-gray-50 transition group"><div class="flex items-center gap-3"><div class="w-8 h-8 bg-gray-100 rounded flex items-center justify-center"><i id="icon-preview-display" class="ph-fill ${s.icon} text-xl text-primary"></i></div><span class="text-sm font-bold text-gray-600 group-hover:text-primary">Selecionar Ícone...</span></div><i class="ph-bold ph-caret-down text-gray-400"></i></button><div id="icon-picker-modal" class="hidden mt-2 bg-white border border-gray-200 rounded-xl shadow-lg p-4 animate-fade-in"><input type="text" id="icon-search-input" oninput="window.app.filterIconGrid(this.value)" placeholder="Buscar..." class="w-full bg-gray-50 border border-gray-200 rounded-lg p-2 text-sm mb-3 focus:outline-none focus:border-accent"><div class="grid grid-cols-6 gap-2 max-h-40 overflow-y-auto custom-scrollbar">${iconGridHTML}</div></div></div><div><label class="text-xs font-bold text-gray-500 uppercase mb-3 block">Tema do Card</label><input type="hidden" id="service-theme-input" value="${s.theme}"><div class="flex gap-4 flex-wrap">${colorDotsHTML}</div></div></div></div><div class="bg-blue-50 p-4 rounded-xl border border-blue-100"><div class="flex items-center justify-between mb-2"><span class="font-bold text-blue-800 text-sm">Preço Promocional?</span><label class="relative inline-flex items-center cursor-pointer"><input type="checkbox" id="service-promo" class="sr-only peer" onchange="${promoToggle}" ${s.isPromotion ? 'checked' : ''}><div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div></label></div><div id="serv-promo-container" class="${s.isPromotion ? '' : 'hidden'} mt-2"><input type="number" step="0.01" id="serv-promo-price" value="${s.promoPrice || ''}" placeholder="Novo Valor" class="w-full bg-white border border-blue-200 rounded-lg p-2 form-input text-blue-900 font-bold"></div></div><div><label class="text-xs font-bold text-gray-500 uppercase">Descrição</label><textarea id="service-desc" rows="3" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-3 form-input text-sm">${s.description}</textarea></div></div>`;
                const footer = `<button onclick="window.app.closeModal()" class="px-4 py-2 text-gray-500">Cancelar</button><button onclick="window.app.saveService(${isEdit})" class="bg-blue-600 text-white px-6 py-2 rounded-lg font-bold">Salvar</button>`;
                window.app.openModalGeneric(isEdit ? "Editar Serviço" : "Novo Serviço", body, footer);
            },
            saveService: (isEdit) => {
                const id = document.getElementById('service-id').value; const name = document.getElementById('service-name').value; const price = parseFloat(document.getElementById('service-price').value); const unit = document.getElementById('service-unit').value; const description = document.getElementById('service-desc').value; const active = document.getElementById('service-active').checked; const isPromotion = document.getElementById('service-promo').checked;
                const icon = document.getElementById('service-icon-input').value || 'ph-star-four'; const theme = document.getElementById('service-theme-input').value || 'default';
                let promoPrice = null;
                if(!name || isNaN(price) || price <= 0) return window.app.toast('Dados inválidos', 'error');
                if (isPromotion) { promoPrice = parseFloat(document.getElementById('serv-promo-price').value); if (isNaN(promoPrice) || promoPrice <= 0 || promoPrice >= price) return window.app.toast('Preço promocional inválido', 'error'); }
                const data = { id: isEdit ? id : 'S' + Date.now(), name, price, unit, description, active, isPromotion, promoPrice, icon, theme };
                if(isEdit) { const idx = DB.services.findIndex(s => s.id === id); if (idx !== -1) DB.services[idx] = data; } else { DB.services.push(data); }
                window.app.toast('Serviço salvo!', 'success'); initDashboard(); window.app.closeModal();
            },

            // ==========================================
            // AUTH & PUBLIC INTERACTION
            // ==========================================
            logout: () => { window.app.openConfirmModal('Sair do Painel', 'Deseja encerrar sua sessão administrativa?', 'warning', 'Sair Agora', () => { isAdmin = false; localStorage.removeItem('isAdmin'); window.location.hash = '#/'; router(); window.app.toast('Você saiu do sistema.', 'success'); }); },
            connectGoogle: () => { user = { name: "Visitante", avatar: "https://placehold.co/40x40/d97706/FFF?text=Eu" }; localStorage.setItem('user', JSON.stringify(user)); initCommunity(); window.app.toast('Conectado como Visitante', 'success'); },
            postComment: () => { const text = document.getElementById('new-comment').value; if(text.trim()) { DB.comments.unshift({ id: Date.now(), user: user.name, avatar: user.avatar, text: text, date: "Agora mesmo" }); initCommunity(); window.app.toast('Comentário publicado!', 'success'); } },
            handleLogin: () => { const e = document.getElementById('email').value; const p = document.getElementById('password').value; if(e === 'admin@ronaldo.com' && p === 'admin') { isAdmin = true; localStorage.setItem('isAdmin', 'true'); window.location.hash = '#/painel'; router(); window.app.toast('Bem-vindo, Chefe!', 'success'); } else { window.app.toast('Credenciais inválidas', 'error'); } },
            openServiceModal: (id) => { const s = DB.services.find(x => x.id === id); const body = `<div class="space-y-6 animate-fade-in"><div class="bg-gradient-to-r from-gray-50 to-white p-6 rounded-xl border border-gray-100 shadow-sm relative overflow-hidden"><div class="absolute right-0 top-0 w-20 h-20 bg-accent/5 rounded-full -mr-5 -mt-5"></div><h4 class="text-lg font-bold text-gray-900 mb-2">${s.name}</h4><p class="text-gray-600 text-sm leading-relaxed mb-4">${s.description}</p><div class="flex items-end justify-between border-t border-gray-100 pt-4"><div><p class="text-xs text-gray-400 uppercase font-bold">Investimento</p><p class="text-2xl font-black text-primary">R$ ${s.price.toFixed(2)}</p></div><span class="text-xs font-medium text-gray-500 bg-gray-100 px-3 py-1 rounded-full">${s.unit || 'Preço Fixo'}</span></div></div><div class="space-y-3"><p class="text-sm font-bold text-gray-700 uppercase tracking-wide">Seus Dados</p><input type="text" placeholder="Nome Completo" class="w-full bg-white border border-gray-200 rounded-lg p-3 text-gray-700 form-input"><input type="email" placeholder="E-mail Profissional" class="w-full bg-white border border-gray-200 rounded-lg p-3 text-gray-700 form-input"><textarea placeholder="Conte um pouco sobre seu projeto..." rows="3" class="w-full bg-white border border-gray-200 rounded-lg p-3 text-gray-700 form-input"></textarea></div></div>`; const footer = `<button onclick="window.app.closeModal()" class="px-5 py-2 text-gray-500 font-bold text-sm">Cancelar</button><button onclick="window.app.closeModal(); window.app.toast('Solicitação enviada!', 'success')" class="bg-primary hover:bg-slate-800 text-white px-8 py-2 rounded-full font-bold shadow-lg transition">Enviar Proposta</button>`; window.app.openModalGeneric("Solicitar Orçamento", body, footer); }
        };

        window.addEventListener('hashchange', router);
        window.addEventListener('load', () => {
            document.getElementById('header-container').innerHTML = TEMPLATES.header;
            initHeaderLogic();
            document.getElementById('footer-container').innerHTML = `<footer class="bg-primary text-white py-16 border-t-4 border-accent text-center"><h4 class="font-serif text-3xl font-bold mb-6">RONALDO <span class="text-accent">PEREIRA</span>.</h4><div class="flex justify-center gap-6 mb-8 text-2xl text-slate-400"><i class="ph-fill ph-instagram hover:text-white cursor-pointer transition"></i><i class="ph-fill ph-twitter-logo hover:text-white cursor-pointer transition"></i><i class="ph-fill ph-envelope-simple hover:text-white cursor-pointer transition"></i></div><p class="text-slate-500 text-sm">&copy; 2025 Todos os direitos reservados.</p></footer>`;
            router();
        });
    </script>
</body>
</html>